<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Getting NJ assessment data into R: part 2 in a series â€” almart.in</title>
	<meta name="description" content="Title: Getting NJ assessment data into R: part 2 in a series; Date: 2015-04-15; Author: Andrew Martin">
	<meta name="author" content="Andrew Martin">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="http://almart.in/theme/html5.js"></script>
		<![endif]-->
	<link href="http://almart.in/theme/css/ipython.css" rel="stylesheet">
	<!-- <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet"> -->
	<!-- <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"> -->
	<!-- <link href="//maxcdn.bootstrapcdn.com/bootswatch/3.2.0/simplex/bootstrap.min.css" rel="stylesheet"> -->
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/bootswatch/3.3.2/simplex/bootstrap.min.css" rel="stylesheet">
	<link href="http://almart.in/theme/css/local.css" rel="stylesheet">
	<link href="http://almart.in/theme/css/pygments.css" rel="stylesheet">
</head>
<body>
<div class="container">
	<!-- NAVBAR -->
	<nav class="navbar navbar-default" style="margin-top:2em;">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="http://almart.in">almart.in</a>
			</div>			
			<!-- MENUITEMS: update the MENUITEMS dict in pelicanconf.py -->
			<div id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav">
					<li><a href="http://almart.in/pages/about.html"><i class="fa fa-user "></i> about</a></li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li><a href="http://almart.in/categories.html"><i class="fa fa-archive"></i> categories</a></li>
					<li><a href="http://almart.in/tags.html"><i class="fa fa-tags"></i> tags</a></li>
					<li><a href="http://almart.in/feeds/all_atom.xml"><i class="fa fa-rss"></i> rss</a></li>
				</ul>
			</div>
		</div>
	</nav>
	
	<!-- MAIN CONTENT: edit in base_site.html template -->
	<div class="row">
		<div class="col-md-8 col-md-offset-2">
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="text-center article-header">
		<h1 itemprop="name headline" class="article-title">Getting NJ assessment data into R: part 2 in a series</h1>
		<span>
			<div itemprop="author" itemscope itemtype="http://schema.org/Person">
				<span itemprop="name">Andrew Martin</span> 
				&nbsp;&#124;&nbsp;
				<time datetime="2015-04-15T00:00:00-04:00" itemprop="datePublished">April 15 2015</time>
				&nbsp;|&nbsp;
				<span><a href="http://almart.in/reading-nj-assess-data-2.txt" title="Raw Markdown for Getting NJ assessment data into R: part 2 in a series">raw</a></span>
			</div>
		</span>
		
	</div>
	<div>
		category:
		<span itemprop="articleSection">
			<a href="http://almart.in/category/education.html" rel="category">education</a>
		</span>
	</div>
	
 
	<div>
		tags:
		<span itemprop="keywords">
			<a href="http://almart.in/tag/nj.html" rel="tag"> NJ</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/assessment.html" rel="tag"> assessment</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/njask.html" rel="tag"> NJASK</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/hspa.html" rel="tag"> HSPA</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/data_management.html" rel="tag"> data_management</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/tutorial.html" rel="tag"> tutorial</a>&nbsp;&nbsp;
		</span>
	</div>
	<div itemprop="articleBody" class="article-body"><p>In my <a href="http://almart.in/reading-nj-assess-data-1.html">last post</a>, I showed how to read a fixed width file into R.  In this post, I'll refactor that code into a function that takes year/grade as a parameter.</p>
<p>First, read in the layout data frame.  This contains the column headers for NJASK fixed with files.</p>
<div class="highlight"><pre><span class="kp">load</span><span class="p">(</span>file <span class="o">=</span> <span class="s">&#39;datasets/njask_layout.rda&#39;</span><span class="p">)</span>
<span class="c1">#also read in the old NJASK layouts</span>
<span class="kp">load</span><span class="p">(</span>file <span class="o">=</span> <span class="s">&#39;datasets/njask05_layout.rda&#39;</span><span class="p">)</span>
<span class="kp">load</span><span class="p">(</span>file <span class="o">=</span> <span class="s">&#39;datasets/njask04_layout.rda&#39;</span><span class="p">)</span>
<span class="kp">load</span><span class="p">(</span>file <span class="o">=</span> <span class="s">&#39;datasets/njask07gr3_layout.rda&#39;</span><span class="p">)</span>

<span class="kp">head</span><span class="p">(</span>layout_njask<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>##   field_start_position field_end_position field_length data_type
## 1                    1                  9            9      Text
## 2                    1                  2            2      Text
## 3                    3                  6            4      Text
## 4                    7                  9            3      Text
## 5                   10                 59           50      Text
## 6                   60                109           50      Text
##                        description
## 1                         CDS Code
## 2 County Code/DFG/Aggregation Code
## 3                    District Code
## 4                      School Code
## 5                      County Name
## 6                    District Name
##                                                                                                                                                                                                                               comments
## 1                                                                                                                                                 For district and school records the first three fields combine to form the CDS code.
## 2 For district and school records this field contains a two-digit county code.  For DFG records, this field contains the DFG code.  For Statewide, Special Needs and Non-Special Needs records, it contains a two-letter abbreviation.
## 3                                                                                                                                                                                     Applicable only for district and school records.
## 4                                                                                                                                                                                     Applicable only for district and school records.
## 5                                                                                                                                                                                     Applicable only for district and school records.
## 6                                                                                                                                                                                     Applicable only for district and school records.
##                                                                                                                                                                                               valid_values
## 1                                                                                                                                                                                                         
## 2 County Code = 01, 03, 05, 07, 09, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 80\nDFG = A, B, CD, DE, FG, GH, I, J, R, V\nST = Statewide, NS = Non-Special Needs, SN = Special Needs
## 3                                                                                                                                                                                      0100 to 9999, blank
## 4                                                                                                                                                                                        001 to 999, blank
## 5                                                                                                                                                                                            A to Z, blank
## 6                                                                                                                                                                                            A to Z, blank
##   spanner1 spanner2                       final_name
## 1                                           CDS_Code
## 2                   County_Code/DFG/Aggregation_Code
## 3                                      District_Code
## 4                                        School_Code
## 5                                        County_Name
## 6                                      District_Name
</pre></div>


<p>Our final call to <code>read_fwf</code> in the last post looked like this:</p>
<div class="highlight"><pre>sample_file <span class="o">=</span> <span class="s">&quot;http://www.state.nj.us/education/schools/achievement/14/njask8/state_summary.txt&quot;</span>

njask14_gr8 <span class="o">&lt;-</span> readr<span class="o">::</span>read_fwf<span class="p">(</span>
  file <span class="o">=</span> sample_file<span class="p">,</span>
  col_positions <span class="o">=</span> readr<span class="o">::</span>fwf_positions<span class="p">(</span>
    start <span class="o">=</span> layout_njask<span class="o">$</span>field_start_position<span class="p">,</span>
    end <span class="o">=</span> layout_njask<span class="o">$</span>field_end_position<span class="p">,</span>
    col_names <span class="o">=</span> layout_njask<span class="o">$</span>final_name
  <span class="p">),</span>
  na <span class="o">=</span> <span class="s">&quot;*&quot;</span>
<span class="p">)</span>
</pre></div>


<p>A script that has a bunch of copy/paste versions of that call would probably get the job done, but we're writing for our <a href="https://xkcd.com/1421/">future selves</a> here, and those url paths are easy to build.  The function should:</p>
<p>1) build the target url</p>
<p>2) use hadley's <code>readr</code> to fetch the fixed with file, using the provided field definitions.</p>
<div class="highlight"><pre>get_raw_njask <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>year<span class="p">,</span> grade<span class="p">,</span> layout<span class="o">=</span>layout_njask<span class="p">)</span> <span class="p">{</span>
  <span class="kn">require</span><span class="p">(</span>readr<span class="p">)</span>

  <span class="c1">#url paths changed after the 2012 assessment</span>
  years <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span>
    <span class="s">&quot;2014&quot;</span><span class="o">=</span><span class="s">&quot;14&quot;</span><span class="p">,</span> <span class="s">&quot;2013&quot;</span><span class="o">=</span><span class="s">&quot;13&quot;</span><span class="p">,</span> <span class="s">&quot;2012&quot;</span><span class="o">=</span><span class="s">&quot;2013&quot;</span><span class="p">,</span> <span class="s">&quot;2011&quot;</span><span class="o">=</span><span class="s">&quot;2012&quot;</span><span class="p">,</span> <span class="s">&quot;2010&quot;</span><span class="o">=</span><span class="s">&quot;2011&quot;</span><span class="p">,</span> <span class="s">&quot;2009&quot;</span><span class="o">=</span><span class="s">&quot;2010&quot;</span><span class="p">,</span> 
    <span class="s">&quot;2008&quot;</span><span class="o">=</span><span class="s">&quot;2009&quot;</span><span class="p">,</span> <span class="s">&quot;2007&quot;</span><span class="o">=</span><span class="s">&quot;2008&quot;</span><span class="p">,</span> <span class="s">&quot;2006&quot;</span><span class="o">=</span><span class="s">&quot;2007&quot;</span><span class="p">,</span> <span class="s">&quot;2005&quot;</span><span class="o">=</span><span class="s">&quot;2006&quot;</span><span class="p">,</span> <span class="s">&quot;2004&quot;</span><span class="o">=</span><span class="s">&quot;2005&quot;</span>
  <span class="p">)</span>
  parsed_year <span class="o">&lt;-</span> years<span class="p">[[</span><span class="kp">as.character</span><span class="p">(</span>year<span class="p">)]]</span>

  <span class="c1">#2008 follows a totally unique pattern</span>
  grade_str <span class="o">&lt;-</span> <span class="kr">if</span> <span class="p">(</span>year<span class="o">==</span><span class="m">2008</span> <span class="o">&amp;</span> grade <span class="o">&gt;=</span><span class="m">5</span><span class="p">)</span> <span class="p">{</span>
    <span class="kp">paste0</span><span class="p">(</span><span class="s">&#39;58/g&#39;</span><span class="p">,</span> grade<span class="p">)</span>
  <span class="p">}</span> <span class="kr">else</span> <span class="p">{</span>
    grade
  <span class="p">}</span>

  <span class="c1">#filenames are also inconsistent </span>
  filename <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span>
    <span class="s">&quot;2014&quot;</span><span class="o">=</span><span class="s">&quot;state_summary.txt&quot;</span><span class="p">,</span> <span class="s">&quot;2013&quot;</span><span class="o">=</span><span class="s">&quot;state_summary.txt&quot;</span><span class="p">,</span> <span class="s">&quot;2012&quot;</span><span class="o">=</span><span class="s">&quot;state_summary.txt&quot;</span><span class="p">,</span>
    <span class="s">&quot;2011&quot;</span><span class="o">=</span><span class="s">&quot;state_summary.txt&quot;</span><span class="p">,</span> <span class="s">&quot;2010&quot;</span><span class="o">=</span><span class="s">&quot;state_summary.txt&quot;</span><span class="p">,</span> <span class="s">&quot;2009&quot;</span><span class="o">=</span><span class="s">&quot;state_summary.txt&quot;</span><span class="p">,</span>
    <span class="s">&quot;2008&quot;</span><span class="o">=</span><span class="s">&quot;state_summary.txt&quot;</span><span class="p">,</span> <span class="s">&quot;2007&quot;</span><span class="o">=</span><span class="s">&quot;state_summary.txt&quot;</span><span class="p">,</span> <span class="s">&quot;2006&quot;</span><span class="o">=</span><span class="s">&quot;state_summary.txt&quot;</span><span class="p">,</span>
    <span class="s">&quot;2005&quot;</span><span class="o">=</span> <span class="kr">if</span><span class="p">(</span>grade<span class="o">==</span><span class="m">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="s">&quot;njask005_state_summary3.txt&quot;</span>
      <span class="p">}</span> <span class="kr">else</span> <span class="kr">if</span> <span class="p">(</span>grade<span class="o">==</span><span class="m">4</span><span class="p">)</span> <span class="p">{</span>
        <span class="s">&quot;njask2005_state_summary4.txt&quot;</span>
      <span class="p">},</span> 
    <span class="s">&quot;2004&quot;</span><span class="o">=</span><span class="kp">paste0</span><span class="p">(</span><span class="s">&quot;njask&quot;</span><span class="p">,</span> grade<span class="p">,</span> <span class="s">&quot;04state_summary.txt&quot;</span><span class="p">)</span>   
  <span class="p">)</span>
  parsed_filename <span class="o">&lt;-</span> filename<span class="p">[[</span><span class="kp">as.character</span><span class="p">(</span>year<span class="p">)]]</span>

  <span class="c1">#build url</span>
  target_url <span class="o">&lt;-</span> <span class="kp">paste0</span><span class="p">(</span>
    <span class="s">&quot;http://www.state.nj.us/education/schools/achievement/&quot;</span><span class="p">,</span> parsed_year<span class="p">,</span> 
    <span class="s">&quot;/njask&quot;</span><span class="p">,</span> grade_str<span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">,</span> parsed_filename
  <span class="p">)</span>

  <span class="kp">print</span><span class="p">(</span>target_url<span class="p">)</span>

  <span class="c1">#read_fwf</span>
  df <span class="o">&lt;-</span> readr<span class="o">::</span>read_fwf<span class="p">(</span>
    file <span class="o">=</span> target_url<span class="p">,</span>
    col_positions <span class="o">=</span> readr<span class="o">::</span>fwf_positions<span class="p">(</span>
      start <span class="o">=</span> layout<span class="o">$</span>field_start_position<span class="p">,</span>
      end <span class="o">=</span> layout<span class="o">$</span>field_end_position<span class="p">,</span>
      col_names <span class="o">=</span> layout<span class="o">$</span>final_name
    <span class="p">),</span>
    na <span class="o">=</span> <span class="s">&quot;*&quot;</span>
  <span class="p">)</span>

  <span class="c1">#return df</span>
  <span class="kr">return</span><span class="p">(</span>df<span class="p">)</span>

<span class="p">}</span>
</pre></div>


<p>Let's give it a try!</p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>magrittr<span class="p">)</span>

ex <span class="o">&lt;-</span> get_raw_njask<span class="p">(</span><span class="m">2014</span><span class="p">,</span> <span class="m">6</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Loading required package: readr
</pre></div>


<div class="highlight"><pre>## Warning: package &#39;readr&#39; was built under R version 3.1.3
</pre></div>


<div class="highlight"><pre>## [1] &quot;http://www.state.nj.us/education/schools/achievement/14/njask6/state_summary.txt&quot;
</pre></div>


<div class="highlight"><pre>dplyr<span class="o">::</span>sample_n<span class="p">(</span>ex<span class="p">[,</span> <span class="kp">sample</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">551</span><span class="p">),</span> <span class="m">10</span><span class="p">)],</span> <span class="m">10</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">as.data.frame</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>##    SPECIAL_EDUCATION_SCIENCE_Number_Enrolled_Science
## 1                                                 NA
## 2                                                 NA
## 3                                                 NA
## 4                                                 NA
## 5                                                 NA
## 6                                                 NA
## 7                                                 NA
## 8                                                 NA
## 9                                                 NA
## 10                                                NA
##    CURRENT_LIMITED_ENGLISH_PROFICIENT_LANGUAGE_ARTS_Number_Not_Present
## 1                                                                   NA
## 2                                                                   NA
## 3                                                                   NA
## 4                                                                   NA
## 5                                                                   NA
## 6                                                                   NA
## 7                                                                   NA
## 8                                                                   NA
## 9                                                                   NA
## 10                                                                  NA
##    NON-MIGRANT_LANGUAGE_ARTS_Advanced_Proficient_Percentage
## 1                                                       150
## 2                                                         0
## 3                                                         0
## 4                                                        53
## 5                                                       209
## 6                                                        71
## 7                                                         9
## 8                                                        70
## 9                                                        NA
## 10                                                       96
##    MALE_LANGUAGE_ARTS_Proficient_Percentage
## 1                                        NA
## 2                                        NA
## 3                                       294
## 4                                       320
## 5                                       721
## 6                                       646
## 7                                       320
## 8                                       585
## 9                                        NA
## 10                                      655
##    NON-MIGRANT_LANGUAGE_ARTS_Scale_Score_Mean
## 1                                        2264
## 2                                        1810
## 3                                        1911
## 4                                        1952
## 5                                        2285
## 6                                        2132
## 7                                        1941
## 8                                        2074
## 9                                          NA
## 10                                       2166
##    AMERICAN_INDIAN_Number_Enrolled_ELA
## 1                                   NA
## 2                                   NA
## 3                                   NA
## 4                                    0
## 5                                    0
## 6                                   NA
## 7                                   NA
## 8                                   NA
## 9                                    0
## 10                                  NA
##    AMERICAN_INDIAN_LANGUAGE_ARTS_Number_of_Valid_Scale_Scores
## 1                                                          NA
## 2                                                          NA
## 3                                                          NA
## 4                                                          NA
## 5                                                          NA
## 6                                                          NA
## 7                                                          NA
## 8                                                          NA
## 9                                                          NA
## 10                                                         NA
##    ECONOMICALLY_DISADVANTAGED_LANGUAGE_ARTS_Number_of_Voids
## 1                                                        NA
## 2                                                         0
## 3                                                        NA
## 4                                                         0
## 5                                                        NA
## 6                                                         0
## 7                                                         1
## 8                                                         0
## 9                                                        NA
## 10                                                        1
##    TOTAL_POPULATION_MATHEMATICS_Number_Enrolled_Math
## 1                                                 22
## 2                                                 57
## 3                                                 36
## 4                                                 39
## 5                                                143
## 6                                                128
## 7                                                114
## 8                                                 71
## 9                                                 NA
## 10                                               684
##    PACIFIC_ISLANDER_LANGUAGE_ARTS_Proficient_Percentage
## 1                                                    NA
## 2                                                    NA
## 3                                                    NA
## 4                                                    NA
## 5                                                    NA
## 6                                                    NA
## 7                                                    NA
## 8                                                    NA
## 9                                                    NA
## 10                                                   NA
</pre></div>


<p>Great - we can definitely pull down all the data files we need.  Now let's make sure that we are doing the necessary cleanup.  In particular, there are 228 columns in our layout file that have the comment 'One implied decimal.'  That really matters - it means that <code>255</code> <em>actually</em> means 25.5.  </p>
<p>For each of those columns, we want to apply a function to each column.  Hadley's <code>dplyr</code> has a nice utility for doing this - <code>mutate_each</code>.</p>
<p>We'll also need to make sure that we only mutate the columns that are tagged with 'One implied decimal.'</p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>dplyr<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## 
## Attaching package: &#39;dplyr&#39;
## 
## The following object is masked from &#39;package:stats&#39;:
## 
##     filter
## 
## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union
</pre></div>


<div class="highlight"><pre>process_njask <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>df<span class="p">,</span> mask<span class="o">=</span>layout_njask<span class="o">$</span>comments<span class="p">)</span> <span class="p">{</span>
  <span class="c1">#keep the names to put back in the same order</span>
  all_names <span class="o">&lt;-</span> <span class="kp">names</span><span class="p">(</span>df<span class="p">)</span>

  <span class="c1">#replace any line breaks in last column</span>
  df<span class="o">$</span>Grade <span class="o">&lt;-</span> <span class="kp">gsub</span><span class="p">(</span><span class="s">&#39;\n&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> df<span class="o">$</span>Grade<span class="p">,</span> fixed <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>

  mask_boolean <span class="o">&lt;-</span> mask <span class="o">==</span> <span class="s">&#39;One implied decimal&#39;</span>
  <span class="c1">#put some columns aside</span>
  ignore <span class="o">&lt;-</span> df<span class="p">[,</span> <span class="o">!</span>mask_boolean<span class="p">]</span>

  <span class="c1">#process the columns that have an implied decimal</span>
  processed <span class="o">&lt;-</span> df<span class="p">[,</span> mask_boolean<span class="p">]</span> <span class="o">%&gt;%</span>
    dplyr<span class="o">::</span>mutate_each<span class="p">(</span>
      dplyr<span class="o">::</span>funs<span class="p">(</span>implied_decimal <span class="o">=</span> <span class="m">.</span> <span class="o">/</span> <span class="m">10</span><span class="p">)</span>  
    <span class="p">)</span>

  <span class="c1">#put back together </span>
  final <span class="o">&lt;-</span> <span class="kp">cbind</span><span class="p">(</span>ignore<span class="p">,</span> processed<span class="p">)</span>

  <span class="c1">#reorder and return</span>
  final <span class="o">%&gt;%</span>
    select<span class="p">(</span>
      one_of<span class="p">(</span><span class="kp">names</span><span class="p">(</span>df<span class="p">))</span>
    <span class="p">)</span>
<span class="p">}</span>

ex_process <span class="o">&lt;-</span> process_njask<span class="p">(</span>ex<span class="p">)</span>

<span class="kp">head</span><span class="p">(</span>ex_process<span class="p">[,</span> <span class="m">1</span><span class="o">:</span><span class="m">15</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre>##    CDS_Code County_Code/DFG/Aggregation_Code District_Code School_Code
## 1        ST                               ST            NA          NA
## 2        SN                               SN            NA          NA
## 3         A                                A            NA          NA
## 4    250100                               25           100          NA
## 5 250100040                               25           100          40
## 6 010110050                               01           110          50
##   County_Name District_Name        School_Name DFG Special_Needs
## 1                                                               
## 2                                                               
## 3                                                               
## 4    MONMOUTH   ASBURY PARK                      A             Y
## 5    MONMOUTH   ASBURY PARK BRADLEY ELEMENTARY   A             Y
## 6    ATLANTIC ATLANTIC CITY    CHELSEA HEIGHTS   A              
##   TOTAL_POPULATION_Number_Enrolled_ELA
## 1                               102513
## 2                                19683
## 3                                16949
## 4                                  121
## 5                                   NA
## 6                                   27
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_Not_Present
## 1                                               212
## 2                                                52
## 3                                                41
## 4                                                 0
## 5                                                NA
## 6                                                 0
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Voids
## 1                                            494
## 2                                            139
## 3                                            114
## 4                                              4
## 5                                             NA
## 6                                              1
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_APA
## 1                                      1016
## 2                                       248
## 3                                       215
## 4                                         0
## 5                                        NA
## 6                                         0
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Valid_Scale_Scores
## 1                                                      100791
## 2                                                       19244
## 3                                                       16579
## 4                                                         117
## 5                                                          NA
## 6                                                          26
##   TOTAL_POPULATION_LANGUAGE_ARTS_Partially_Proficient_Percentage
## 1                                                           33.0
## 2                                                           60.3
## 3                                                           61.4
## 4                                                           87.2
## 5                                                             NA
## 6                                                            7.7
</pre></div>


<p>Now we put it all together, with a little wrapper function around the <code>get_raw_njask</code> and <code>process_njask</code> functions:</p>
<div class="highlight"><pre>fetch_njask <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>year<span class="p">,</span> grade<span class="p">)</span> <span class="p">{</span>
  <span class="kr">if</span> <span class="p">(</span>year <span class="o">==</span> <span class="m">2004</span><span class="p">)</span> <span class="p">{</span>
    df <span class="o">&lt;-</span> get_raw_njask<span class="p">(</span>year<span class="p">,</span> grade<span class="p">,</span> layout<span class="o">=</span>layout_njask04<span class="p">)</span>  <span class="o">%&gt;%</span> 
      process_njask<span class="p">(</span>mask<span class="o">=</span>layout_njask04<span class="o">$</span>comments<span class="p">)</span>
  <span class="p">}</span>
  <span class="kr">else</span> <span class="kr">if</span> <span class="p">(</span>year <span class="o">==</span> <span class="m">2005</span><span class="p">)</span> <span class="p">{</span>
    df <span class="o">&lt;-</span> get_raw_njask<span class="p">(</span>year<span class="p">,</span> grade<span class="p">,</span> layout<span class="o">=</span>layout_njask05<span class="p">)</span>  <span class="o">%&gt;%</span> 
      process_njask<span class="p">(</span>mask<span class="o">=</span>layout_njask05<span class="o">$</span>comments<span class="p">)</span> 
  <span class="p">}</span> <span class="kr">else</span> <span class="kr">if</span> <span class="p">(</span>year <span class="o">%in%</span> <span class="kt">c</span><span class="p">(</span><span class="m">2006</span><span class="p">,</span> <span class="m">2007</span><span class="p">,</span> <span class="m">2008</span><span class="p">)</span> <span class="o">&amp;</span> grade <span class="o">%in%</span> <span class="kt">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">))</span> <span class="p">{</span>
    df <span class="o">&lt;-</span> get_raw_njask<span class="p">(</span>year<span class="p">,</span> grade<span class="p">,</span> layout<span class="o">=</span>layout_njask07gr3<span class="p">)</span>  <span class="o">%&gt;%</span> 
      process_njask<span class="p">(</span>mask<span class="o">=</span>layout_njask07gr3<span class="o">$</span>comments<span class="p">)</span> 
  <span class="p">}</span>
  <span class="kr">else</span> <span class="p">{</span>
    df <span class="o">&lt;-</span> get_raw_njask<span class="p">(</span>year<span class="p">,</span> grade<span class="p">)</span> <span class="o">%&gt;%</span> process_njask<span class="p">()</span>    
  <span class="p">}</span>

  <span class="kr">return</span><span class="p">(</span>df<span class="p">)</span>
<span class="p">}</span>

fetch_njask<span class="p">(</span><span class="m">2014</span><span class="p">,</span> <span class="m">6</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">head</span><span class="p">()</span> <span class="o">%&gt;%</span> select<span class="p">(</span>CDS_Code<span class="o">:</span>TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## [1] &quot;http://www.state.nj.us/education/schools/achievement/14/njask6/state_summary.txt&quot;
</pre></div>


<div class="highlight"><pre>##    CDS_Code County_Code/DFG/Aggregation_Code District_Code School_Code
## 1        ST                               ST            NA          NA
## 2        SN                               SN            NA          NA
## 3         A                                A            NA          NA
## 4    250100                               25           100          NA
## 5 250100040                               25           100          40
## 6 010110050                               01           110          50
##   County_Name District_Name        School_Name DFG Special_Needs
## 1                                                               
## 2                                                               
## 3                                                               
## 4    MONMOUTH   ASBURY PARK                      A             Y
## 5    MONMOUTH   ASBURY PARK BRADLEY ELEMENTARY   A             Y
## 6    ATLANTIC ATLANTIC CITY    CHELSEA HEIGHTS   A              
##   TOTAL_POPULATION_Number_Enrolled_ELA
## 1                               102513
## 2                                19683
## 3                                16949
## 4                                  121
## 5                                   NA
## 6                                   27
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_Not_Present
## 1                                               212
## 2                                                52
## 3                                                41
## 4                                                 0
## 5                                                NA
## 6                                                 0
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Voids
## 1                                            494
## 2                                            139
## 3                                            114
## 4                                              4
## 5                                             NA
## 6                                              1
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_APA
## 1                                      1016
## 2                                       248
## 3                                       215
## 4                                         0
## 5                                        NA
## 6                                         0
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Valid_Scale_Scores
## 1                                                      100791
## 2                                                       19244
## 3                                                       16579
## 4                                                         117
## 5                                                          NA
## 6                                                          26
##   TOTAL_POPULATION_LANGUAGE_ARTS_Partially_Proficient_Percentage
## 1                                                           33.0
## 2                                                           60.3
## 3                                                           61.4
## 4                                                           87.2
## 5                                                             NA
## 6                                                            7.7
##   TOTAL_POPULATION_LANGUAGE_ARTS_Proficient_Percentage
## 1                                                 58.1
## 2                                                 38.2
## 3                                                 37.3
## 4                                                 12.8
## 5                                                   NA
## 6                                                 92.3
##   TOTAL_POPULATION_LANGUAGE_ARTS_Advanced_Proficient_Percentage
## 1                                                           8.8
## 2                                                           1.5
## 3                                                           1.3
## 4                                                           0.0
## 5                                                            NA
## 6                                                           0.0
##   TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean
## 1                                           211.2
## 2                                           193.2
## 3                                           192.3
## 4                                           175.4
## 5                                              NA
## 6                                           215.8
</pre></div>


<p>There's a more data out there than just the grade 3 NJASK, though.  In my<a href="http://almart.in/reading-nj-assess-data-3.html">next post</a>, we'll tackle the HSPA, and dive into some older data - the 'Grade Eight Proficiency Assessment' (GEPA) that used to be offered to students at the end of middle school, with the ultimate goal of stitching everything together into a simplified R interface for NJ assessment data.</p></div>
	<hr>

	
</div>
		</div>
	</div>
</div>

<!-- FOOTER -->
<div class="container">
	<div class="row">
		<div class="col-md-11 text-center center-block aw-bottom">
			<p>almart.in is built with <a href="http://docs.getpelican.com/en/3.5.0/#">pelican</a></p>
		</div>
	</div>
</div>
<!-- JavaScript -->
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script type="text/javascript">
jQuery(document).ready(function($) {
	$("div.collapseheader").click(function () {
		$header = $(this).children("span").first();
		$codearea = $(this).children(".input_area");
		$codearea.slideToggle(500, function () {
			$header.text(function () {
				return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
			});
		});
	});
});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61809650-1', 'auto');
  ga('send', 'pageview');

</script>

 
</body>
</html>