<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Getting NJ assessment data into R: part 3 in a series. â€” almart.in</title>
	<meta name="description" content="Title: Getting NJ assessment data into R: part 3 in a series.; Date: 2015-04-16; Author: Andrew Martin">
	<meta name="author" content="Andrew Martin">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="http://almart.in/theme/html5.js"></script>
		<![endif]-->
	<link href="http://almart.in/theme/css/ipython.css" rel="stylesheet">
	<!-- <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet"> -->
	<!-- <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"> -->
	<!-- <link href="//maxcdn.bootstrapcdn.com/bootswatch/3.2.0/simplex/bootstrap.min.css" rel="stylesheet"> -->
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/bootswatch/3.3.2/simplex/bootstrap.min.css" rel="stylesheet">
	<link href="http://almart.in/theme/css/local.css" rel="stylesheet">
	<link href="http://almart.in/theme/css/pygments.css" rel="stylesheet">
</head>
<body>
<div class="container">
	<!-- NAVBAR -->
	<nav class="navbar navbar-default" style="margin-top:2em;">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="http://almart.in">almart.in</a>
			</div>			
			<!-- MENUITEMS: update the MENUITEMS dict in pelicanconf.py -->
			<div id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav">
					<li><a href="http://almart.in/pages/about.html"><i class="fa fa-user "></i> about</a></li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li><a href="http://almart.in/categories.html"><i class="fa fa-archive"></i> categories</a></li>
					<li><a href="http://almart.in/tags.html"><i class="fa fa-tags"></i> tags</a></li>
					<li><a href="http://almart.infeeds/all.atom.xml"><i class="fa fa-rss"></i> rss</a></li>
				</ul>
			</div>
		</div>
	</nav>
	
	<!-- MAIN CONTENT: edit in base_site.html template -->
	<div class="row">
		<div class="col-md-8 col-md-offset-2">
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="text-center article-header">
		<h1 itemprop="name headline" class="article-title">Getting NJ assessment data into R: part 3 in a series.</h1>
		<span>
			<div itemprop="author" itemscope itemtype="http://schema.org/Person">
				<span itemprop="name">Andrew Martin</span> 
				&nbsp;&#124;&nbsp;
				<time datetime="2015-04-16T00:00:00-04:00" itemprop="datePublished">April 16 2015</time>
				&nbsp;|&nbsp;
				<span><a href="http://almart.in/reading-nj-assess-data-3.txt" title="Raw Markdown for Getting NJ assessment data into R: part 3 in a series.">raw</a></span>
			</div>
		</span>
		
	</div>
	<div>
		category:
		<span itemprop="articleSection">
			<a href="http://almart.in/category/education.html" rel="category">education</a>
		</span>
	</div>
	
 
	<div>
		tags:
		<span itemprop="keywords">
			<a href="http://almart.in/tag/nj.html" rel="tag"> NJ</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/assessment.html" rel="tag"> assessment</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/njask.html" rel="tag"> NJASK</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/hspa.html" rel="tag"> HSPA</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/data_management.html" rel="tag"> data_management</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/tutorial.html" rel="tag"> tutorial</a>&nbsp;&nbsp;
		</span>
	</div>
	<div itemprop="articleBody" class="article-body"><p>In my <a href="http://almart.in/reading-nj-assess-data-3.html">last post</a>, I talked about how to programmatically process and cleanup NJASK data.  In this post, we'll extend the NJASK functions to the High School Proficiency Assessment (HSPA), and to the old Grade Eight Proficiency Assessment (GEPA).  With functions that can access each of those data sources, we'll be ready to write a general wrapper that simplifies access to relevant state assessment data.</p>
<h1>HSPA</h1>
<p>Much like the NJASK data in posts <a href="http://almart.in/reading-nj-assess-data-1.html">1</a> and <a href="http://almart.in/reading-nj-assess-data-2.html">2</a>, we're going to read from a fixed width file on the state website, use a layout file to name the variables, and do some post-processing.  I also <a href="http://almart.in/pages/hspa-layout.html">wrote up</a> how to process the HSPA metadata, if data processing is your thing.</p>
<p>Load in those processed files:</p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>readr<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>dplyr<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>magrittr<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="kp">load</span><span class="p">(</span>file <span class="o">=</span> <span class="s">&#39;datasets/hspa_layout.rda&#39;</span><span class="p">)</span>
<span class="kp">load</span><span class="p">(</span>file <span class="o">=</span> <span class="s">&#39;datasets/hspa2010_layout.rda&#39;</span><span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>layout_hspa<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="err">##</span>   <span class="nt">field_start_position</span> <span class="nt">field_end_position</span> <span class="nt">field_length</span> <span class="nt">data_type</span>
<span class="err">##</span> <span class="nt">1</span>                    <span class="nt">1</span>                  <span class="nt">9</span>            <span class="nt">9</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">2</span>                    <span class="nt">1</span>                  <span class="nt">9</span>            <span class="nt">9</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">3</span>                    <span class="nt">1</span>                  <span class="nt">2</span>            <span class="nt">2</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">4</span>                    <span class="nt">3</span>                  <span class="nt">6</span>            <span class="nt">4</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">5</span>                    <span class="nt">7</span>                  <span class="nt">9</span>            <span class="nt">3</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">6</span>                   <span class="nt">10</span>                 <span class="nt">59</span>           <span class="nt">50</span>      <span class="nt">Text</span>
<span class="err">##</span>     <span class="nt">description</span>                                              <span class="nt">comments</span>
<span class="err">##</span> <span class="nt">1</span>    <span class="nt">RECORD</span> <span class="nt">KEY</span>                                                      
<span class="err">##</span> <span class="nt">2</span>      <span class="nt">CDS</span> <span class="nt">Code</span>                                                      
<span class="err">##</span> <span class="nt">3</span>   <span class="nt">County</span> <span class="nt">Code</span>                                                      
<span class="err">##</span> <span class="nt">4</span> <span class="nt">District</span> <span class="nt">Code</span> <span class="nt">Applicable</span> <span class="nt">only</span> <span class="nt">for</span> <span class="nt">district</span> <span class="nt">and</span> <span class="nt">school</span> <span class="nt">aggregations</span><span class="o">.</span>
<span class="err">##</span> <span class="nt">5</span>   <span class="nt">School</span> <span class="nt">Code</span>              <span class="nt">Applicable</span> <span class="nt">only</span> <span class="nt">for</span> <span class="nt">school</span> <span class="nt">aggregations</span><span class="o">.</span>
<span class="err">##</span> <span class="nt">6</span>   <span class="nt">County</span> <span class="nt">Name</span>                                                      
<span class="err">##</span>                                                                                                                                                                                               <span class="nt">valid_values</span>
<span class="err">##</span> <span class="nt">1</span>                                                                                                                                                                                                         
<span class="err">##</span> <span class="nt">2</span> <span class="nt">CDS</span> <span class="nt">codes</span> <span class="nt">for</span> <span class="nt">schools</span> <span class="nt">and</span> <span class="nt">districts</span><span class="err">\</span><span class="nt">nTHE</span> <span class="nt">FIRST</span> <span class="nt">TWO</span> <span class="nt">POSITIONS</span> <span class="nt">WILL</span> <span class="nt">INCLUDE</span> <span class="nt">THE</span> <span class="nt">FOLLOWING</span> <span class="nt">AGGREGATION</span> <span class="nt">CODES</span><span class="o">:</span> <span class="nt">NS</span> <span class="o">=</span> <span class="nt">Non-Special</span> <span class="nt">Needs</span><span class="o">;</span> <span class="nt">SN</span> <span class="o">=</span> <span class="nt">Special</span> <span class="nt">Needs</span><span class="o">;</span> <span class="nt">ST</span> <span class="o">=</span> <span class="nt">State</span><span class="o">;</span> <span class="nt">A</span> <span class="o">=</span> <span class="nt">DFG</span> <span class="nt">A</span><span class="o">;</span> <span class="nt">B</span> <span class="o">=</span> <span class="nt">DFG</span> <span class="nt">B</span><span class="o">;</span> <span class="nt">CD</span><span class="o">=</span> <span class="nt">DFG</span> <span class="nt">CD</span><span class="err">\</span><span class="nt">x85</span><span class="o">.</span>
<span class="err">##</span> <span class="nt">3</span>                                                                                                       <span class="nt">01</span><span class="o">,</span> <span class="nt">03</span><span class="o">,</span> <span class="nt">05</span><span class="o">,</span> <span class="nt">07</span><span class="o">,</span> <span class="nt">09</span><span class="o">,</span> <span class="nt">11</span><span class="o">,</span> <span class="nt">13</span><span class="o">,</span> <span class="nt">15</span><span class="o">,</span> <span class="nt">17</span><span class="o">,</span> <span class="nt">19</span><span class="o">,</span> <span class="nt">21</span><span class="o">,</span> <span class="nt">23</span><span class="o">,</span> <span class="nt">25</span><span class="o">,</span> <span class="nt">27</span><span class="o">,</span> <span class="nt">29</span><span class="o">,</span> <span class="nt">31</span><span class="o">,</span> <span class="nt">33</span><span class="o">,</span> <span class="nt">35</span><span class="o">,</span> <span class="nt">37</span><span class="o">,</span> <span class="nt">39</span><span class="o">,</span> <span class="nt">41</span><span class="o">,</span> <span class="nt">43</span><span class="o">,</span> <span class="nt">45</span><span class="o">,</span> <span class="nt">47</span><span class="o">,</span> <span class="nt">80</span>
<span class="err">##</span> <span class="nt">4</span>                                                                                                                                                                                      <span class="nt">0100</span> <span class="nt">to</span> <span class="nt">9999</span><span class="o">,</span> <span class="nt">blank</span>
<span class="err">##</span> <span class="nt">5</span>                                                                                                                                                                                        <span class="nt">001</span> <span class="nt">to</span> <span class="nt">999</span><span class="o">,</span> <span class="nt">blank</span>
<span class="err">##</span> <span class="nt">6</span>                                                                                                                                     <span class="nt">A</span> <span class="nt">to</span> <span class="nt">Z</span><span class="o">,</span> <span class="nt">blank</span><span class="o">;</span>  <span class="nt">Applicable</span> <span class="nt">only</span> <span class="nt">for</span> <span class="nt">district</span> <span class="nt">and</span> <span class="nt">school</span> <span class="nt">aggregations</span>
<span class="err">##</span>   <span class="nt">spanner1</span> <span class="nt">spanner2</span>    <span class="nt">final_name</span>
<span class="err">##</span> <span class="nt">1</span>                      <span class="nt">RECORD_KEY</span>
<span class="err">##</span> <span class="nt">2</span>                        <span class="nt">CDS_Code</span>
<span class="err">##</span> <span class="nt">3</span>                     <span class="nt">County_Code</span>
<span class="err">##</span> <span class="nt">4</span>                   <span class="nt">District_Code</span>
<span class="err">##</span> <span class="nt">5</span>                     <span class="nt">School_Code</span>
<span class="err">##</span> <span class="nt">6</span>                     <span class="nt">County_Name</span>
</pre></div>


<p>Use the layout file to process an example HSPA data file:</p>
<div class="highlight"><pre>hspa_url <span class="o">&lt;-</span> <span class="s">&#39;http://www.state.nj.us/education/schools/achievement/14/hspa/state_summary.txt&#39;</span>

hspa_ex <span class="o">&lt;-</span> readr<span class="o">::</span>read_fwf<span class="p">(</span>
  file <span class="o">=</span> hspa_url<span class="p">,</span>
  col_positions <span class="o">=</span> readr<span class="o">::</span>fwf_positions<span class="p">(</span>
    start <span class="o">=</span> layout_hspa<span class="o">$</span>field_start_position<span class="p">,</span>
    end <span class="o">=</span> layout_hspa<span class="o">$</span>field_end_position<span class="p">,</span>
    col_names <span class="o">=</span> layout_hspa<span class="o">$</span>final_name
  <span class="p">),</span>
  na <span class="o">=</span> <span class="s">&quot;*&quot;</span>
<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   DFG = col_integer(),
##   Special_Needs = col_integer(),
##   TOTAL_POPULATION_Number_Enrolled_LAL = col_integer(),
##   TOTAL_POPULATION_LANGUAGE_ARTS_Partially_Proficient_Percentage = col_integer(),
##   TOTAL_POPULATION_LANGUAGE_ARTS_Proficient_Percentage = col_integer(),
##   TOTAL_POPULATION_LANGUAGE_ARTS_Advanced_Proficient_Percentage = col_integer(),
##   TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean = col_integer(),
##   TOTAL_POPULATION_MATHEMATICS_Number_Enrolled_Math = col_integer(),
##   TOTAL_POPULATION_MATHEMATICS_Number_of_Valid_Scale_Scores = col_integer(),
##   TOTAL_POPULATION_SCIENCE_Number_of_Valid_Scale_Scores = col_integer(),
##   TOTAL_POPULATION_SCIENCE_Proficient_Percentage = col_integer(),
##   TOTAL_POPULATION_SCIENCE_Advanced_Proficient_Percentage = col_integer(),
##   TOTAL_POPULATION_SCIENCE_Scale_Score_Mean = col_integer(),
##   GENERAL_EDUCATION_Number_Enrolled_LAL = col_integer(),
##   GENERAL_EDUCATION_LANGUAGE_ARTS_Proficient_Percentage = col_integer(),
##   GENERAL_EDUCATION_LANGUAGE_ARTS_Scale_Score_Mean = col_integer(),
##   GENERAL_EDUCATION_MATHEMATICS_Number_Enrolled_Math = col_integer(),
##   GENERAL_EDUCATION_MATHEMATICS_Number_of_Valid_Scale_Scores = col_integer(),
##   GENERAL_EDUCATION_SCIENCE_Number_of_Valid_Scale_Scores = col_integer(),
##   GENERAL_EDUCATION_SCIENCE_Partially_Proficient_Percentage = col_integer()
##   # ... with 202 more columns
## )
</pre></div>


<div class="highlight"><pre>## See spec(...) for full column specifications.
</pre></div>


<div class="highlight"><pre>## Warning: 1484 parsing failures.
## row                                                                        col    expected      actual
##   1 SCIENCE_SPECIAL_EDUCATION_WITH_ACCOMMODATIONS_Number_of_Valid_Scale_Scores 6 chars     0          
##   1 NA                                                                         559 columns 555 columns
##   2 SCIENCE_SPECIAL_EDUCATION_WITH_ACCOMMODATIONS_Number_of_Valid_Scale_Scores 6 chars     0          
##   2 NA                                                                         559 columns 555 columns
##   3 SCIENCE_SPECIAL_EDUCATION_WITH_ACCOMMODATIONS_Number_of_Valid_Scale_Scores 6 chars     0          
## ... .......................................................................... ........... ...........
## See problems(...) for more details.
</pre></div>


<div class="highlight"><pre>hspa_ex <span class="o">%&gt;%</span> <span class="kp">as.data.frame</span><span class="p">()</span> <span class="o">%&gt;%</span> select<span class="p">(</span>CDS_Code<span class="o">:</span>TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean<span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>##   CDS_Code County_Code District_Code School_Code County_Name
## 1                                                           
## 2                                                           
## 3                                                           
## 4                                                           
## 5 MONMOUTH                                       ASBURY PARK
## 6 MONMOUTH                                       ASBURY PARK
##      District_Name     School_Name DFG Special_Needs
## 1                      98240   507  14             8
## 2                      83656   342  12             0
## 3                      14584   165   2             8
## 4                      11988   150   2             9
## 5                  A Y    73     1  NA             1
## 6 ASBURY PARK H.S. A Y    73     1  NA             1
##   TOTAL_POPULATION_Number_Enrolled_LAL
## 1                                97091
## 2                                82776
## 3                                14315
## 4                                11750
## 5                                   71
## 6                                   71
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_Not_Present
## 1                                              67 6
## 2                                              46 5
## 3                                             190 7
## 4                                             203 7
## 5                                             366 6
## 6                                             366 6
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Voids
## 1                                         04 328
## 2                                         86 367
## 3                                         08 103
## 4                                         08  88
## 5                                         34  00
## 6                                         34  00
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Valid_Scale_Scores
## 1                                                      2368 9
## 2                                                      2396 8
## 3                                                      2201 1
## 4                                                      2187 1
## 5                                                        2039
## 6                                                        2039
##   TOTAL_POPULATION_LANGUAGE_ARTS_Partially_Proficient_Percentage
## 1                                                           8240
## 2                                                           3656
## 3                                                           4584
## 4                                                           1988
## 5                                                             73
## 6                                                             73
##   TOTAL_POPULATION_LANGUAGE_ARTS_Proficient_Percentage
## 1                                                    6
## 2                                                    4
## 3                                                    2
## 4                                                    2
## 5                                                   NA
## 6                                                   NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Advanced_Proficient_Percentage
## 1                                                            63
## 2                                                            42
## 3                                                            21
## 4                                                            10
## 5                                                             1
## 6                                                             1
##   TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean
## 1                                             129
## 2                                             110
## 3                                              19
## 4                                              16
## 5                                               0
## 6                                               0
</pre></div>


<p>That gets us to a similar state as we were in for the NJASK data - we have all the columns identified, but there's a need for post-processing, especially for the percentage columns, which have 'One implied decimal.'</p>
<p>We can take the formula we wrote to process NJASK data frames and generalize it, so that it can handle both NJASK and HSPA data.</p>
<div class="highlight"><pre>process_nj_assess <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>df<span class="p">,</span> layout<span class="p">)</span> <span class="p">{</span>
  <span class="c1">#build a mask</span>
  mask <span class="o">&lt;-</span> layout<span class="o">$</span>comments <span class="o">==</span> <span class="s">&#39;One implied decimal&#39;</span>

  <span class="c1">#keep the names to put back in the same order</span>
  all_names <span class="o">&lt;-</span> <span class="kp">names</span><span class="p">(</span>df<span class="p">)</span>

  <span class="c1">#make sure df is data frame (not dplyr data frame) so that normal subsetting</span>
  df <span class="o">&lt;-</span> <span class="kp">as.data.frame</span><span class="p">(</span>df<span class="p">)</span>

  <span class="c1">#get name of last column and kill \n characters</span>
  last_col <span class="o">&lt;-</span> <span class="kp">names</span><span class="p">(</span>df<span class="p">)[</span><span class="kp">ncol</span><span class="p">(</span>df<span class="p">)]</span>
  df<span class="p">[,</span> last_col<span class="p">]</span> <span class="o">&lt;-</span> <span class="kp">gsub</span><span class="p">(</span><span class="s">&#39;\n&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> df<span class="p">[,</span> last_col<span class="p">],</span> fixed <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>

  <span class="c1">#put some columns aside</span>
  ignore <span class="o">&lt;-</span> df<span class="p">[,</span> <span class="o">!</span>mask<span class="p">]</span>

  implied_decimal_fix <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
    <span class="c1">#strip out anything that&#39;s not a number.</span>
    x <span class="o">&lt;-</span> <span class="kp">as.numeric</span><span class="p">(</span><span class="kp">gsub</span><span class="p">(</span><span class="s">&quot;[^\\d]+&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> x<span class="p">,</span> perl<span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span>
    x <span class="o">/</span> <span class="m">10</span>
  <span class="p">}</span>

  <span class="c1">#process the columns that have an implied decimal</span>
  processed <span class="o">&lt;-</span> df<span class="p">[,</span> mask<span class="p">]</span> <span class="o">%&gt;%</span>
    dplyr<span class="o">::</span>mutate_each<span class="p">(</span>
      dplyr<span class="o">::</span>funs<span class="p">(</span>implied_decimal_fix<span class="p">)</span>  
    <span class="p">)</span>

  <span class="c1">#put back together </span>
  final <span class="o">&lt;-</span> <span class="kp">cbind</span><span class="p">(</span>ignore<span class="p">,</span> processed<span class="p">)</span>

  <span class="c1">#reorder and return</span>
  final <span class="o">%&gt;%</span>
    select<span class="p">(</span>
      one_of<span class="p">(</span><span class="kp">names</span><span class="p">(</span>df<span class="p">))</span>
    <span class="p">)</span>
<span class="p">}</span>

process_nj_assess<span class="p">(</span>hspa_ex<span class="p">,</span> layout_hspa<span class="p">)</span> <span class="o">%&gt;%</span> select<span class="p">(</span>CDS_Code<span class="o">:</span>TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean<span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>##   CDS_Code County_Code District_Code School_Code County_Name
## 1                                                           
## 2                                                           
## 3                                                           
## 4                                                           
## 5 MONMOUTH                                       ASBURY PARK
## 6 MONMOUTH                                       ASBURY PARK
##      District_Name     School_Name DFG Special_Needs
## 1                      98240   507  14             8
## 2                      83656   342  12             0
## 3                      14584   165   2             8
## 4                      11988   150   2             9
## 5                  A Y    73     1  NA             1
## 6 ASBURY PARK H.S. A Y    73     1  NA             1
##   TOTAL_POPULATION_Number_Enrolled_LAL
## 1                                97091
## 2                                82776
## 3                                14315
## 4                                11750
## 5                                   71
## 6                                   71
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_Not_Present
## 1                                              67 6
## 2                                              46 5
## 3                                             190 7
## 4                                             203 7
## 5                                             366 6
## 6                                             366 6
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Voids
## 1                                         04 328
## 2                                         86 367
## 3                                         08 103
## 4                                         08  88
## 5                                         34  00
## 6                                         34  00
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Valid_Scale_Scores
## 1                                                      2368 9
## 2                                                      2396 8
## 3                                                      2201 1
## 4                                                      2187 1
## 5                                                        2039
## 6                                                        2039
##   TOTAL_POPULATION_LANGUAGE_ARTS_Partially_Proficient_Percentage
## 1                                                          824.0
## 2                                                          365.6
## 3                                                          458.4
## 4                                                          198.8
## 5                                                            7.3
## 6                                                            7.3
##   TOTAL_POPULATION_LANGUAGE_ARTS_Proficient_Percentage
## 1                                                  0.6
## 2                                                  0.4
## 3                                                  0.2
## 4                                                  0.2
## 5                                                   NA
## 6                                                   NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Advanced_Proficient_Percentage
## 1                                                           6.3
## 2                                                           4.2
## 3                                                           2.1
## 4                                                           1.0
## 5                                                           0.1
## 6                                                           0.1
##   TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean
## 1                                            12.9
## 2                                            11.0
## 3                                             1.9
## 4                                             1.6
## 5                                             0.0
## 6                                             0.0
</pre></div>


<p>Yep, that totally works.  Following from the NJASK example, we'll write a function to simplify fetching the HSPA data, and a final wrapper around the fetch/process steps.</p>
<div class="highlight"><pre>get_raw_hspa <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>year<span class="p">,</span> layout<span class="o">=</span>layout_hspa<span class="p">)</span> <span class="p">{</span>
  <span class="kn">require</span><span class="p">(</span>readr<span class="p">)</span>

  <span class="c1">#url paths changed in 2012</span>
  years <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span>
    <span class="s">&quot;2014&quot;</span><span class="o">=</span><span class="s">&quot;14&quot;</span><span class="p">,</span> <span class="s">&quot;2013&quot;</span><span class="o">=</span><span class="s">&quot;13&quot;</span><span class="p">,</span> <span class="s">&quot;2012&quot;</span><span class="o">=</span><span class="s">&quot;2013&quot;</span><span class="p">,</span> <span class="s">&quot;2011&quot;</span><span class="o">=</span><span class="s">&quot;2012&quot;</span><span class="p">,</span> <span class="s">&quot;2010&quot;</span><span class="o">=</span><span class="s">&quot;2011&quot;</span><span class="p">,</span> <span class="s">&quot;2009&quot;</span><span class="o">=</span><span class="s">&quot;2010&quot;</span><span class="p">,</span> 
    <span class="s">&quot;2008&quot;</span><span class="o">=</span><span class="s">&quot;2009&quot;</span><span class="p">,</span> <span class="s">&quot;2007&quot;</span><span class="o">=</span><span class="s">&quot;2008&quot;</span><span class="p">,</span> <span class="s">&quot;2006&quot;</span><span class="o">=</span><span class="s">&quot;2007&quot;</span><span class="p">,</span> <span class="s">&quot;2005&quot;</span><span class="o">=</span><span class="s">&quot;2006&quot;</span><span class="p">,</span> <span class="s">&quot;2004&quot;</span><span class="o">=</span><span class="s">&quot;2005&quot;</span>
  <span class="p">)</span>
  parsed_year <span class="o">&lt;-</span> years<span class="p">[[</span><span class="kp">as.character</span><span class="p">(</span>year<span class="p">)]]</span>

  <span class="c1">#filenames are screwy</span>
  parsed_filename <span class="o">&lt;-</span> <span class="kr">if</span><span class="p">(</span>year <span class="o">&gt;</span> <span class="m">2005</span><span class="p">)</span> <span class="p">{</span>
    <span class="s">&quot;state_summary.txt&quot;</span>
  <span class="p">}</span> <span class="kr">else</span> <span class="kr">if</span> <span class="p">(</span>year <span class="o">==</span> <span class="m">2005</span><span class="p">)</span> <span class="p">{</span>
    <span class="s">&quot;2005hspa_state_summary.txt&quot;</span> 
  <span class="p">}</span> <span class="kr">else</span> <span class="kr">if</span> <span class="p">(</span>year <span class="o">==</span> <span class="m">2004</span><span class="p">)</span> <span class="p">{</span>
    <span class="s">&quot;hspa04state_summary.txt&quot;</span>
  <span class="p">}</span>

  <span class="c1">#build url</span>
  target_url <span class="o">&lt;-</span> <span class="kp">paste0</span><span class="p">(</span>
    <span class="s">&quot;http://www.state.nj.us/education/schools/achievement/&quot;</span><span class="p">,</span> parsed_year<span class="p">,</span> 
    <span class="s">&quot;/hspa/&quot;</span><span class="p">,</span> parsed_filename
  <span class="p">)</span>

  <span class="c1">#read_fwf</span>
  df <span class="o">&lt;-</span> readr<span class="o">::</span>read_fwf<span class="p">(</span>
    file <span class="o">=</span> target_url<span class="p">,</span>
    col_positions <span class="o">=</span> readr<span class="o">::</span>fwf_positions<span class="p">(</span>
      start <span class="o">=</span> layout<span class="o">$</span>field_start_position<span class="p">,</span>
      end <span class="o">=</span> layout<span class="o">$</span>field_end_position<span class="p">,</span>
      col_names <span class="o">=</span> layout<span class="o">$</span>final_name
    <span class="p">),</span>
    na <span class="o">=</span> <span class="s">&quot;*&quot;</span>
  <span class="p">)</span>

  <span class="c1">#return df</span>
  <span class="kr">return</span><span class="p">(</span>df<span class="p">)</span>

<span class="p">}</span>

<span class="c1">#final wrapper</span>
fetch_hspa <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>year<span class="p">)</span> <span class="p">{</span>
  <span class="kr">if</span> <span class="p">(</span>year <span class="o">&gt;=</span> <span class="m">2011</span><span class="p">)</span> <span class="p">{</span>
    hspa_df <span class="o">&lt;-</span> get_raw_hspa<span class="p">(</span>year<span class="p">)</span> <span class="o">%&gt;%</span> process_nj_assess<span class="p">(</span>layout<span class="o">=</span>layout_hspa<span class="p">)</span>
  <span class="p">}</span> <span class="kr">else</span> <span class="kr">if</span> <span class="p">(</span>year <span class="o">&gt;=</span> <span class="m">2004</span><span class="p">)</span> <span class="p">{</span>
    hspa_df <span class="o">&lt;-</span> get_raw_hspa<span class="p">(</span>year<span class="p">,</span> layout<span class="o">=</span>layout_hspa2010<span class="p">)</span> <span class="o">%&gt;%</span> process_nj_assess<span class="p">(</span>layout<span class="o">=</span>layout_hspa2010<span class="p">)</span> 
  <span class="p">}</span>

  <span class="kr">return</span><span class="p">(</span>hspa_df<span class="p">)</span>
<span class="p">}</span>

fetch_hspa<span class="p">(</span><span class="m">2010</span><span class="p">)</span> <span class="o">%&gt;%</span> select<span class="p">(</span>CDS_Code<span class="o">:</span>TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean<span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   DFG = col_integer(),
##   Special_Needs = col_integer(),
##   TOTAL_POPULATION_Number_Enrolled_LAL = col_integer(),
##   TOTAL_POPULATION_LANGUAGE_ARTS_Partially_Proficient_Percentage = col_integer(),
##   TOTAL_POPULATION_LANGUAGE_ARTS_Proficient_Percentage = col_integer(),
##   TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean = col_integer(),
##   TOTAL_POPULATION_MATHEMATICS_Number_Enrolled_Math = col_integer(),
##   TOTAL_POPULATION_MATHEMATICS_Number_of_Valid_Scale_Scores = col_integer(),
##   TOTAL_POPULATION_SCIENCE_Number_of_Valid_Scale_Scores = col_integer(),
##   TOTAL_POPULATION_SCIENCE_Proficient_Percentage = col_integer(),
##   TOTAL_POPULATION_SCIENCE_Scale_Score_Mean = col_integer(),
##   GENERAL_EDUCATION_Number_Enrolled_LAL = col_integer(),
##   GENERAL_EDUCATION_LANGUAGE_ARTS_Proficient_Percentage = col_integer(),
##   GENERAL_EDUCATION_LANGUAGE_ARTS_Advanced_Proficient_Percentage = col_integer(),
##   GENERAL_EDUCATION_LANGUAGE_ARTS_Scale_Score_Mean = col_integer(),
##   GENERAL_EDUCATION_MATHEMATICS_Number_Enrolled_Math = col_integer(),
##   GENERAL_EDUCATION_MATHEMATICS_Number_of_Valid_Scale_Scores = col_integer(),
##   GENERAL_EDUCATION_SCIENCE_Number_of_Valid_Scale_Scores = col_integer(),
##   GENERAL_EDUCATION_SCIENCE_Partially_Proficient_Percentage = col_integer(),
##   GENERAL_EDUCATION_SCIENCE_Proficient_Percentage = col_integer()
##   # ... with 189 more columns
## )
</pre></div>


<div class="highlight"><pre>## See spec(...) for full column specifications.
</pre></div>


<div class="highlight"><pre>##   CDS_Code County_Code District_Code School_Code County_Name
## 1                                                           
## 2                                                           
## 3                                                           
## 4                                                           
## 5 MONMOUTH                                       ASBURY PARK
## 6 MONMOUTH                                       ASBURY PARK
##      District_Name     School_Name DFG Special_Needs
## 1                      99548   551  19             9
## 2                      85256   356  12             6
## 3                      14292   195   7             3
## 4                      11673   179   6             4
## 5                  A Y   107     1  NA             0
## 6 ASBURY PARK H.S. A Y   107     1  NA             0
##   TOTAL_POPULATION_Number_Enrolled_LAL
## 1                                98257
## 2                                84337
## 3                                13920
## 4                                11347
## 5                                  103
## 6                                  103
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_Not_Present
## 1                                             129 6
## 2                                              92 7
## 3                                             351 6
## 4                                             374 5
## 5                                             524 4
## 6                                             524 4
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Voids
## 1                                         87 184
## 2                                         00 208
## 3                                         06  43
## 4                                         89  37
## 5                                         76  00
## 6                                         76  00
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Valid_Scale_Scores
## 1                                                      2273 9
## 2                                                      2309 8
## 3                                                      2053 1
## 4                                                      2035 1
## 5                                                        1867
## 6                                                        1867
##   TOTAL_POPULATION_LANGUAGE_ARTS_Partially_Proficient_Percentage
## 1                                                          954.8
## 2                                                          525.6
## 3                                                          429.2
## 4                                                          167.3
## 5                                                           10.7
## 6                                                           10.7
##   TOTAL_POPULATION_LANGUAGE_ARTS_Proficient_Percentage
## 1                                                  0.6
## 2                                                  0.4
## 3                                                  0.2
## 4                                                  0.2
## 5                                                   NA
## 6                                                   NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Advanced_Proficient_Percentage
## 1                                                           7.0
## 2                                                           0.7
## 3                                                           6.3
## 4                                                           3.0
## 5                                                           0.4
## 6                                                           0.4
##   TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean
## 1                                            13.9
## 2                                            11.3
## 3                                             2.6
## 4                                             2.2
## 5                                             0.0
## 6                                             0.0
</pre></div>


<p>Nice!  NJASK and HSPA down, GEPA data to go.</p>
<h1>GEPA</h1>
<p>Load in the processed GEPA layout file, and the old NJASK layout file.</p>
<div class="highlight"><pre><span class="kp">load</span><span class="p">(</span>file <span class="o">=</span> <span class="s">&#39;datasets/gepa_layout.rda&#39;</span><span class="p">)</span>
<span class="kp">load</span><span class="p">(</span>file <span class="o">=</span> <span class="s">&#39;datasets/njask05_layout.rda&#39;</span><span class="p">)</span>

<span class="kp">head</span><span class="p">(</span>layout_gepa<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="err">##</span>   <span class="nt">field_start_position</span> <span class="nt">field_end_position</span> <span class="nt">field_length</span> <span class="nt">data_type</span>
<span class="err">##</span> <span class="nt">1</span>                    <span class="nt">1</span>                  <span class="nt">9</span>            <span class="nt">9</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">2</span>                    <span class="nt">1</span>                  <span class="nt">2</span>            <span class="nt">2</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">3</span>                    <span class="nt">3</span>                  <span class="nt">6</span>            <span class="nt">4</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">4</span>                    <span class="nt">7</span>                  <span class="nt">9</span>            <span class="nt">3</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">5</span>                   <span class="nt">10</span>                 <span class="nt">59</span>           <span class="nt">50</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">6</span>                   <span class="nt">60</span>                <span class="nt">109</span>           <span class="nt">50</span>      <span class="nt">Text</span>
<span class="err">##</span>     <span class="nt">description</span> <span class="nt">comments</span>
<span class="err">##</span> <span class="nt">1</span>      <span class="nt">CDS</span> <span class="nt">Code</span>         
<span class="err">##</span> <span class="nt">2</span>   <span class="nt">County</span> <span class="nt">Code</span>         
<span class="err">##</span> <span class="nt">3</span> <span class="nt">District</span> <span class="nt">Code</span>         
<span class="err">##</span> <span class="nt">4</span>   <span class="nt">School</span> <span class="nt">Code</span>         
<span class="err">##</span> <span class="nt">5</span>   <span class="nt">County</span> <span class="nt">Name</span>         
<span class="err">##</span> <span class="nt">6</span> <span class="nt">District</span> <span class="nt">Name</span>         
<span class="err">##</span>                                                                                                                                                                                               <span class="nt">valid_values</span>
<span class="err">##</span> <span class="nt">1</span> <span class="nt">CDS</span> <span class="nt">codes</span> <span class="nt">for</span> <span class="nt">schools</span> <span class="nt">and</span> <span class="nt">districts</span><span class="err">\</span><span class="nt">nTHE</span> <span class="nt">FIRST</span> <span class="nt">TWO</span> <span class="nt">POSITIONS</span> <span class="nt">WILL</span> <span class="nt">INCLUDE</span> <span class="nt">THE</span> <span class="nt">FOLLOWING</span> <span class="nt">AGGREGATION</span> <span class="nt">CODES</span><span class="o">:</span> <span class="nt">NS</span> <span class="o">=</span> <span class="nt">Non-Special</span> <span class="nt">Needs</span><span class="o">;</span> <span class="nt">SN</span> <span class="o">=</span> <span class="nt">Special</span> <span class="nt">Needs</span><span class="o">;</span> <span class="nt">ST</span> <span class="o">=</span> <span class="nt">State</span><span class="o">;</span> <span class="nt">A</span> <span class="o">=</span> <span class="nt">DFG</span> <span class="nt">A</span><span class="o">;</span> <span class="nt">B</span> <span class="o">=</span> <span class="nt">DFG</span> <span class="nt">B</span><span class="o">;</span> <span class="nt">CD</span><span class="o">=</span> <span class="nt">DFG</span> <span class="nt">CD</span><span class="err">\</span><span class="nt">x85</span><span class="o">.</span>
<span class="err">##</span> <span class="nt">2</span>                                                                        <span class="nt">01</span><span class="o">,</span> <span class="nt">03</span><span class="o">,</span> <span class="nt">05</span><span class="o">,</span> <span class="nt">07</span><span class="o">,</span> <span class="nt">09</span><span class="o">,</span> <span class="nt">11</span><span class="o">,</span> <span class="nt">13</span><span class="o">,</span> <span class="nt">15</span><span class="o">,</span> <span class="nt">17</span><span class="o">,</span> <span class="nt">19</span><span class="o">,</span> <span class="nt">21</span><span class="o">,</span> <span class="nt">23</span><span class="o">,</span> <span class="nt">25</span><span class="o">,</span> <span class="nt">27</span><span class="o">,</span> <span class="nt">29</span><span class="o">,</span> <span class="nt">31</span><span class="o">,</span> <span class="nt">33</span><span class="o">,</span> <span class="nt">35</span><span class="o">,</span> <span class="nt">37</span><span class="o">,</span> <span class="nt">39</span><span class="o">,</span> <span class="nt">41</span><span class="o">,</span> <span class="nt">80</span><span class="o">,</span> <span class="nt">ST</span><span class="o">,</span> <span class="nt">A</span><span class="o">,</span> <span class="nt">B</span><span class="o">,</span> <span class="nt">CD</span><span class="o">,</span> <span class="nt">DE</span><span class="o">,</span> <span class="nt">FG</span><span class="o">,</span> <span class="nt">GH</span><span class="o">,</span> <span class="nt">I</span><span class="o">,</span> <span class="nt">J</span><span class="o">,</span> <span class="nt">R</span><span class="o">,</span> <span class="nt">NS</span><span class="o">,</span> <span class="nt">SN</span>
<span class="err">##</span> <span class="nt">3</span>                                                                                                                                      <span class="nt">0100</span> <span class="nt">to</span> <span class="nt">9999</span><span class="o">;</span>  <span class="nt">Applicable</span> <span class="nt">only</span> <span class="nt">for</span> <span class="nt">district</span> <span class="nt">and</span> <span class="nt">school</span> <span class="nt">aggregations</span>
<span class="err">##</span> <span class="nt">4</span>                                                                                                                                                     <span class="nt">001</span> <span class="nt">to</span> <span class="nt">999</span><span class="o">;</span>  <span class="nt">Applicable</span> <span class="nt">only</span> <span class="nt">for</span> <span class="nt">school</span> <span class="nt">aggregations</span>
<span class="err">##</span> <span class="nt">5</span>                                                                                                                                     <span class="nt">A</span> <span class="nt">to</span> <span class="nt">Z</span><span class="o">,</span> <span class="nt">blank</span><span class="o">;</span>  <span class="nt">Applicable</span> <span class="nt">only</span> <span class="nt">for</span> <span class="nt">district</span> <span class="nt">and</span> <span class="nt">school</span> <span class="nt">aggregations</span>
<span class="err">##</span> <span class="nt">6</span>                                                                                                                                     <span class="nt">A</span> <span class="nt">to</span> <span class="nt">Z</span><span class="o">,</span> <span class="nt">blank</span><span class="o">;</span>  <span class="nt">Applicable</span> <span class="nt">only</span> <span class="nt">for</span> <span class="nt">district</span> <span class="nt">and</span> <span class="nt">school</span> <span class="nt">aggregations</span>
<span class="err">##</span>   <span class="nt">spanner1</span> <span class="nt">spanner2</span>    <span class="nt">final_name</span>
<span class="err">##</span> <span class="nt">1</span>                        <span class="nt">CDS_Code</span>
<span class="err">##</span> <span class="nt">2</span>                     <span class="nt">County_Code</span>
<span class="err">##</span> <span class="nt">3</span>                   <span class="nt">District_Code</span>
<span class="err">##</span> <span class="nt">4</span>                     <span class="nt">School_Code</span>
<span class="err">##</span> <span class="nt">5</span>                     <span class="nt">County_Name</span>
<span class="err">##</span> <span class="nt">6</span>                   <span class="nt">District_Name</span>
</pre></div>


<p>A function to get GEPA data:</p>
<div class="highlight"><pre>get_raw_gepa <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>year<span class="p">,</span> layout<span class="o">=</span>layout_gepa<span class="p">)</span> <span class="p">{</span>
  <span class="kn">require</span><span class="p">(</span>readr<span class="p">)</span>

  <span class="c1">#url paths changed in 2012</span>
  years <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span>
    <span class="s">&quot;2007&quot;</span><span class="o">=</span><span class="s">&quot;2008&quot;</span><span class="p">,</span> <span class="s">&quot;2006&quot;</span><span class="o">=</span><span class="s">&quot;2007&quot;</span><span class="p">,</span> <span class="s">&quot;2005&quot;</span><span class="o">=</span><span class="s">&quot;2006&quot;</span><span class="p">,</span> <span class="s">&quot;2004&quot;</span><span class="o">=</span><span class="s">&quot;2005&quot;</span>
  <span class="p">)</span>
  parsed_year <span class="o">&lt;-</span> years<span class="p">[[</span><span class="kp">as.character</span><span class="p">(</span>year<span class="p">)]]</span>

  filename <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span>
    <span class="s">&quot;2007&quot;</span><span class="o">=</span><span class="s">&quot;state_summary.txt&quot;</span><span class="p">,</span> <span class="s">&quot;2006&quot;</span><span class="o">=</span><span class="s">&quot;state_summary.txt&quot;</span><span class="p">,</span>
    <span class="s">&quot;2005&quot;</span><span class="o">=</span><span class="s">&quot;2005njgepa_state_summary.txt&quot;</span><span class="p">,</span> <span class="s">&quot;2004&quot;</span><span class="o">=</span><span class="s">&quot;gepa04state_summary.txt&quot;</span>   
  <span class="p">)</span>
  parsed_filename <span class="o">&lt;-</span> filename<span class="p">[[</span><span class="kp">as.character</span><span class="p">(</span>year<span class="p">)]]</span>

  <span class="c1">#build url</span>
  target_url <span class="o">&lt;-</span> <span class="kp">paste0</span><span class="p">(</span>
    <span class="s">&quot;http://www.state.nj.us/education/schools/achievement/&quot;</span><span class="p">,</span> parsed_year<span class="p">,</span> 
    <span class="s">&quot;/gepa/&quot;</span><span class="p">,</span> parsed_filename
  <span class="p">)</span>

  <span class="c1">#read_fwf</span>
  df <span class="o">&lt;-</span> readr<span class="o">::</span>read_fwf<span class="p">(</span>
    file <span class="o">=</span> target_url<span class="p">,</span>
    col_positions <span class="o">=</span> readr<span class="o">::</span>fwf_positions<span class="p">(</span>
      start <span class="o">=</span> layout<span class="o">$</span>field_start_position<span class="p">,</span>
      end <span class="o">=</span> layout<span class="o">$</span>field_end_position<span class="p">,</span>
      col_names <span class="o">=</span> layout<span class="o">$</span>final_name
    <span class="p">),</span>
    na <span class="o">=</span> <span class="s">&quot;*&quot;</span>
  <span class="p">)</span>

  <span class="c1">#return df</span>
  <span class="kr">return</span><span class="p">(</span>df<span class="p">)</span>

<span class="p">}</span>

gepa_ex <span class="o">&lt;-</span> get_raw_gepa<span class="p">(</span><span class="m">2007</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   `Special_Needs_(Abbott)_district_flag` = col_integer(),
##   MALE_SCIENCE_Scale_Score_Mean = col_integer(),
##   MIGRANT_MATHEMATICS_Number_of_Valid_Scale_Scores = col_integer(),
##   MIGRANT_SCIENCE_Number_of_Valid_Scale_Scores = col_integer(),
##   PACIFIC_ISLANDER_LANGUAGE_ARTS_Proficient_Percentage = col_integer(),
##   `NON-ECONOMICALLY_DISADVANTAGED_Non-Econ_SCIENCE_Scale_Score_Mean` = col_integer()
## )
</pre></div>


<div class="highlight"><pre>## See spec(...) for full column specifications.
</pre></div>


<div class="highlight"><pre>## Warning: 2448 parsing failures.
## row                                                              col    expected      actual
##   1 NON-ECONOMICALLY_DISADVANTAGED_Non-Econ_SCIENCE_Scale_Score_Mean 4 chars     1          
##   1 NA                                                               486 columns 484 columns
##   2 NON-ECONOMICALLY_DISADVANTAGED_Non-Econ_SCIENCE_Scale_Score_Mean 4 chars     1          
##   2 NA                                                               486 columns 484 columns
##   3 NON-ECONOMICALLY_DISADVANTAGED_Non-Econ_SCIENCE_Scale_Score_Mean 4 chars     1          
## ... ................................................................ ........... ...........
## See problems(...) for more details.
</pre></div>


<div class="highlight"><pre>gepa_ex <span class="o">%&gt;%</span> <span class="kp">as.data.frame</span><span class="p">()</span> <span class="o">%&gt;%</span> select<span class="p">(</span>CDS_Code<span class="o">:</span>TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean<span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>##    CDS_Code County_Code District_Code School_Code County_Name
## 1        ST                                                  
## 2        NS                                                  
## 3        SN                                                  
## 4         A                                                  
## 5 250100000          MO          NMOU          TH   ASBURY PA
## 6 250100070          MO          NMOU          TH   ASBURY PA
##                                        District_Name
## 1                                                   
## 2                                                   
## 3                                                   
## 4                                                   
## 5                                                 RK
## 6 RK                                       ASBURY PA
##                                      School_Name DFG_Flag
## 1                                         108474       00
## 2                                         087774       00
## 3                                         020700       00
## 4                                         017401       00
## 5                                          A Y *     &lt;NA&gt;
## 6 RK M.S.                                  A Y *     &lt;NA&gt;
##   Special_Needs_(Abbott)_district_flag TOTAL_POPULATION_Number_Enrolled
## 1                                    0                           667001
## 2                                    0                           371000
## 3                                    0                           296000
## 4                                    0                           264000
## 5                                   NA                             &lt;NA&gt;
## 6                                   NA                             &lt;NA&gt;
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_Not_Present
## 1                                            262000
## 2                                            668000
## 3                                            594000
## 4                                            509000
## 5                                              &lt;NA&gt;
## 6                                              &lt;NA&gt;
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Voids
## 1                                         680105
## 2                                         545086
## 3                                         135019
## 4                                         102016
## 5                                           &lt;NA&gt;
## 6                                           &lt;NA&gt;
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_APA
## 1                                       865026
## 2                                       190020
## 3                                       675052
## 4                                       526053
## 5                                          071
## 6                                          071
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Valid_Scale_Scores
## 1                                                      406240
## 2                                                      506630
## 3                                                      204500
## 4                                                      104420
## 5                                                      502780
## 6                                                      502780
##   TOTAL_POPULATION_LANGUAGE_ARTS_Partially_Proficient_Percentage
## 1                                                           1132
## 2                                                           1322
## 3                                                           0281
## 4                                                           0271
## 5                                                           0071
## 6                                                           0071
##   TOTAL_POPULATION_LANGUAGE_ARTS_Proficient_Percentage
## 1                                                 1490
## 2                                                 1930
## 3                                                 9530
## 4                                                 9460
## 5                                                  842
## 6                                                  842
##   TOTAL_POPULATION_LANGUAGE_ARTS_Advanced_Proficient_Percentage
## 1                                                          0066
## 2                                                          0038
## 3                                                          0027
## 4                                                          0024
## 5                                                          &lt;NA&gt;
## 6                                                          &lt;NA&gt;
##   TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean
## 1                                            1000
## 2                                            5000
## 3                                            6000
## 4                                            5000
## 5                                            &lt;NA&gt;
## 6                                            &lt;NA&gt;
</pre></div>


<p>Can we process the GEPA df using our existing function?</p>
<div class="highlight"><pre>process_nj_assess<span class="p">(</span>gepa_ex<span class="p">,</span> layout_gepa<span class="p">)</span> <span class="o">%&gt;%</span> select<span class="p">(</span>CDS_Code<span class="o">:</span>TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean<span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>##    CDS_Code County_Code District_Code School_Code County_Name
## 1        ST                                                  
## 2        NS                                                  
## 3        SN                                                  
## 4         A                                                  
## 5 250100000          MO          NMOU          TH   ASBURY PA
## 6 250100070          MO          NMOU          TH   ASBURY PA
##                                        District_Name
## 1                                                   
## 2                                                   
## 3                                                   
## 4                                                   
## 5                                                 RK
## 6 RK                                       ASBURY PA
##                                      School_Name DFG_Flag
## 1                                         108474       00
## 2                                         087774       00
## 3                                         020700       00
## 4                                         017401       00
## 5                                          A Y *     &lt;NA&gt;
## 6 RK M.S.                                  A Y *     &lt;NA&gt;
##   Special_Needs_(Abbott)_district_flag TOTAL_POPULATION_Number_Enrolled
## 1                                    0                           667001
## 2                                    0                           371000
## 3                                    0                           296000
## 4                                    0                           264000
## 5                                   NA                             &lt;NA&gt;
## 6                                   NA                             &lt;NA&gt;
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_Not_Present
## 1                                            262000
## 2                                            668000
## 3                                            594000
## 4                                            509000
## 5                                              &lt;NA&gt;
## 6                                              &lt;NA&gt;
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Voids
## 1                                         680105
## 2                                         545086
## 3                                         135019
## 4                                         102016
## 5                                           &lt;NA&gt;
## 6                                           &lt;NA&gt;
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_APA
## 1                                       865026
## 2                                       190020
## 3                                       675052
## 4                                       526053
## 5                                          071
## 6                                          071
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Valid_Scale_Scores
## 1                                                      406240
## 2                                                      506630
## 3                                                      204500
## 4                                                      104420
## 5                                                      502780
## 6                                                      502780
##   TOTAL_POPULATION_LANGUAGE_ARTS_Partially_Proficient_Percentage
## 1                                                          113.2
## 2                                                          132.2
## 3                                                           28.1
## 4                                                           27.1
## 5                                                            7.1
## 6                                                            7.1
##   TOTAL_POPULATION_LANGUAGE_ARTS_Proficient_Percentage
## 1                                                149.0
## 2                                                193.0
## 3                                                953.0
## 4                                                946.0
## 5                                                 84.2
## 6                                                 84.2
##   TOTAL_POPULATION_LANGUAGE_ARTS_Advanced_Proficient_Percentage
## 1                                                           6.6
## 2                                                           3.8
## 3                                                           2.7
## 4                                                           2.4
## 5                                                            NA
## 6                                                            NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean
## 1                                             100
## 2                                             500
## 3                                             600
## 4                                             500
## 5                                              NA
## 6                                              NA
</pre></div>


<p>Yes, totally.<br />
Final step: write all of that into a final wrapper function:</p>
<div class="highlight"><pre><span class="c1">#final wrapper</span>
fetch_gepa <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>year<span class="p">)</span> <span class="p">{</span>
  get_raw_gepa<span class="p">(</span>year<span class="p">)</span> <span class="o">%&gt;%</span> process_nj_assess<span class="p">(</span>layout<span class="o">=</span>layout_gepa<span class="p">)</span>

<span class="p">}</span>

fetch_gepa<span class="p">(</span><span class="m">2007</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">as.data.frame</span><span class="p">()</span> <span class="o">%&gt;%</span> select<span class="p">(</span>CDS_Code<span class="o">:</span>TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean<span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   `Special_Needs_(Abbott)_district_flag` = col_integer(),
##   MALE_SCIENCE_Scale_Score_Mean = col_integer(),
##   MIGRANT_MATHEMATICS_Number_of_Valid_Scale_Scores = col_integer(),
##   MIGRANT_SCIENCE_Number_of_Valid_Scale_Scores = col_integer(),
##   PACIFIC_ISLANDER_LANGUAGE_ARTS_Proficient_Percentage = col_integer(),
##   `NON-ECONOMICALLY_DISADVANTAGED_Non-Econ_SCIENCE_Scale_Score_Mean` = col_integer()
## )
</pre></div>


<div class="highlight"><pre>## See spec(...) for full column specifications.
</pre></div>


<div class="highlight"><pre>## Warning: 2448 parsing failures.
## row                                                              col    expected      actual
##   1 NON-ECONOMICALLY_DISADVANTAGED_Non-Econ_SCIENCE_Scale_Score_Mean 4 chars     1          
##   1 NA                                                               486 columns 484 columns
##   2 NON-ECONOMICALLY_DISADVANTAGED_Non-Econ_SCIENCE_Scale_Score_Mean 4 chars     1          
##   2 NA                                                               486 columns 484 columns
##   3 NON-ECONOMICALLY_DISADVANTAGED_Non-Econ_SCIENCE_Scale_Score_Mean 4 chars     1          
## ... ................................................................ ........... ...........
## See problems(...) for more details.
</pre></div>


<div class="highlight"><pre>##    CDS_Code County_Code District_Code School_Code County_Name
## 1        ST                                                  
## 2        NS                                                  
## 3        SN                                                  
## 4         A                                                  
## 5 250100000          MO          NMOU          TH   ASBURY PA
## 6 250100070          MO          NMOU          TH   ASBURY PA
##                                        District_Name
## 1                                                   
## 2                                                   
## 3                                                   
## 4                                                   
## 5                                                 RK
## 6 RK                                       ASBURY PA
##                                      School_Name DFG_Flag
## 1                                         108474       00
## 2                                         087774       00
## 3                                         020700       00
## 4                                         017401       00
## 5                                          A Y *     &lt;NA&gt;
## 6 RK M.S.                                  A Y *     &lt;NA&gt;
##   Special_Needs_(Abbott)_district_flag TOTAL_POPULATION_Number_Enrolled
## 1                                    0                           667001
## 2                                    0                           371000
## 3                                    0                           296000
## 4                                    0                           264000
## 5                                   NA                             &lt;NA&gt;
## 6                                   NA                             &lt;NA&gt;
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_Not_Present
## 1                                            262000
## 2                                            668000
## 3                                            594000
## 4                                            509000
## 5                                              &lt;NA&gt;
## 6                                              &lt;NA&gt;
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Voids
## 1                                         680105
## 2                                         545086
## 3                                         135019
## 4                                         102016
## 5                                           &lt;NA&gt;
## 6                                           &lt;NA&gt;
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_APA
## 1                                       865026
## 2                                       190020
## 3                                       675052
## 4                                       526053
## 5                                          071
## 6                                          071
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Valid_Scale_Scores
## 1                                                      406240
## 2                                                      506630
## 3                                                      204500
## 4                                                      104420
## 5                                                      502780
## 6                                                      502780
##   TOTAL_POPULATION_LANGUAGE_ARTS_Partially_Proficient_Percentage
## 1                                                          113.2
## 2                                                          132.2
## 3                                                           28.1
## 4                                                           27.1
## 5                                                            7.1
## 6                                                            7.1
##   TOTAL_POPULATION_LANGUAGE_ARTS_Proficient_Percentage
## 1                                                149.0
## 2                                                193.0
## 3                                                953.0
## 4                                                946.0
## 5                                                 84.2
## 6                                                 84.2
##   TOTAL_POPULATION_LANGUAGE_ARTS_Advanced_Proficient_Percentage
## 1                                                           6.6
## 2                                                           3.8
## 3                                                           2.7
## 4                                                           2.4
## 5                                                            NA
## 6                                                            NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean
## 1                                             100
## 2                                             500
## 3                                             600
## 4                                             500
## 5                                              NA
## 6                                              NA
</pre></div>


<p>In the <a href="http://almart.in/reading-nj-assess-data-4.html">next post</a> in this series, we'll take these individual NJASK, HSPA, and GEPA functions and write one wrapper to rule them all, allowing data to be easily fetched for any year/grade.</p></div>
	<hr>

	
</div>
		</div>
	</div>
</div>

<!-- FOOTER -->
<div class="container">
	<div class="row">
		<div class="col-md-11 text-center center-block aw-bottom">
			<p>almart.in is built with <a href="http://docs.getpelican.com/en/3.5.0/#">pelican</a></p>
		</div>
	</div>
</div>
<!-- JavaScript -->
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script type="text/javascript">
jQuery(document).ready(function($) {
	$("div.collapseheader").click(function () {
		$header = $(this).children("span").first();
		$codearea = $(this).children(".input_area");
		$codearea.slideToggle(500, function () {
			$header.text(function () {
				return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
			});
		});
	});
});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61809650-1', 'auto');
  ga('send', 'pageview');

</script>

 
</body>
</html>