<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Getting NJ assessment data into R: part 3 in a series. — almart.in</title>
	<meta name="description" content="Title: Getting NJ assessment data into R: part 3 in a series.; Date: 2015-04-16; Author: Andrew Martin">
	<meta name="author" content="Andrew Martin">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="http://almart.in/theme/html5.js"></script>
		<![endif]-->
	<link href="http://almart.in/theme/css/ipython.css" rel="stylesheet">
	<!-- <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet"> -->
	<!-- <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"> -->
	<!-- <link href="//maxcdn.bootstrapcdn.com/bootswatch/3.2.0/simplex/bootstrap.min.css" rel="stylesheet"> -->
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/bootswatch/3.3.2/simplex/bootstrap.min.css" rel="stylesheet">
	<link href="http://almart.in/theme/css/local.css" rel="stylesheet">
	<link href="http://almart.in/theme/css/pygments.css" rel="stylesheet">
</head>
<body>
<div class="container">
	<!-- NAVBAR -->
	<nav class="navbar navbar-default" style="margin-top:2em;">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="http://almart.in">almart.in</a>
			</div>			
			<!-- MENUITEMS: update the MENUITEMS dict in pelicanconf.py -->
			<div id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav">
					<li><a href="http://almart.in/pages/about.html"><i class="fa fa-user "></i> about</a></li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li><a href="http://almart.in/categories.html"><i class="fa fa-archive"></i> categories</a></li>
					<li><a href="http://almart.in/tags.html"><i class="fa fa-tags"></i> tags</a></li>
					<li><a href="http://almart.in/feeds/all_atom.xml"><i class="fa fa-rss"></i> rss</a></li>
				</ul>
			</div>
		</div>
	</nav>
	
	<!-- MAIN CONTENT: edit in base_site.html template -->
	<div class="row">
		<div class="col-md-8 col-md-offset-2">
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="text-center article-header">
		<h1 itemprop="name headline" class="article-title">Getting NJ assessment data into R: part 3 in a series.</h1>
		<span>
			<div itemprop="author" itemscope itemtype="http://schema.org/Person">
				<span itemprop="name">Andrew Martin</span> 
				&nbsp;&#124;&nbsp;
				<time datetime="2015-04-16T00:00:00-04:00" itemprop="datePublished">April 16 2015</time>
				&nbsp;|&nbsp;
				<span><a href="http://almart.in/reading-nj-assess-data-3.txt" title="Raw Markdown for Getting NJ assessment data into R: part 3 in a series.">raw</a></span>
			</div>
		</span>
		
	</div>
	<div>
		category:
		<span itemprop="articleSection">
			<a href="http://almart.in/category/education.html" rel="category">education</a>
		</span>
	</div>
	
 
	<div>
		tags:
		<span itemprop="keywords">
			<a href="http://almart.in/tag/nj.html" rel="tag"> NJ</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/assessment.html" rel="tag"> assessment</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/njask.html" rel="tag"> NJASK</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/hspa.html" rel="tag"> HSPA</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/data_management.html" rel="tag"> data_management</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/tutorial.html" rel="tag"> tutorial</a>&nbsp;&nbsp;
		</span>
	</div>
	<div itemprop="articleBody" class="article-body"><p>In my <a href="" title="/reading-nj-assess-data-2.html">last post</a>, I talked about how to programmatically process and cleanup NJASK data.  In this post, we'll extend the NJASK functions to the High School Proficiency Assessment (HSPA), and to the old Grade Eight Proficiency Assessment (GEPA).  With functions that can access each of those data sources, we'll be ready to write a general wrapper that simplifies access to relevant state assessment data.</p>
<h1>HSPA</h1>
<p>Much like the NJASK data in posts <a href="" title="/reading-nj-assess-data-1.html">1</a> and <a href="" title="/reading-nj-assess-data-2.html">2</a>, we're going to read from a fixed width file on the state website, use a layout file to name the variables, and do some postprocessing.  I wrote up how to process the HSPA metadata <a href="" title="/hspa-layout.html">here</a>, if data processing is your thing.</p>
<p>Load in those processed files:</p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>readr<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>dplyr<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>magrittr<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="kp">load</span><span class="p">(</span>file <span class="o">=</span> <span class="s">&#39;datasets/hspa_layout.rda&#39;</span><span class="p">)</span>
<span class="kp">load</span><span class="p">(</span>file <span class="o">=</span> <span class="s">&#39;datasets/hspa2010_layout.rda&#39;</span><span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>layout_hspa<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="err">##</span>   <span class="nt">field_start_position</span> <span class="nt">field_end_position</span> <span class="nt">field_length</span> <span class="nt">data_type</span>
<span class="err">##</span> <span class="nt">1</span>                    <span class="nt">1</span>                  <span class="nt">9</span>            <span class="nt">9</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">2</span>                    <span class="nt">1</span>                  <span class="nt">9</span>            <span class="nt">9</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">3</span>                    <span class="nt">1</span>                  <span class="nt">2</span>            <span class="nt">2</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">4</span>                    <span class="nt">3</span>                  <span class="nt">6</span>            <span class="nt">4</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">5</span>                    <span class="nt">7</span>                  <span class="nt">9</span>            <span class="nt">3</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">6</span>                   <span class="nt">10</span>                 <span class="nt">59</span>           <span class="nt">50</span>      <span class="nt">Text</span>
<span class="err">##</span>     <span class="nt">description</span>                                              <span class="nt">comments</span>
<span class="err">##</span> <span class="nt">1</span>    <span class="nt">RECORD</span> <span class="nt">KEY</span>                                                      
<span class="err">##</span> <span class="nt">2</span>      <span class="nt">CDS</span> <span class="nt">Code</span>                                                      
<span class="err">##</span> <span class="nt">3</span>   <span class="nt">County</span> <span class="nt">Code</span>                                                      
<span class="err">##</span> <span class="nt">4</span> <span class="nt">District</span> <span class="nt">Code</span> <span class="nt">Applicable</span> <span class="nt">only</span> <span class="nt">for</span> <span class="nt">district</span> <span class="nt">and</span> <span class="nt">school</span> <span class="nt">aggregations</span><span class="o">.</span>
<span class="err">##</span> <span class="nt">5</span>   <span class="nt">School</span> <span class="nt">Code</span>              <span class="nt">Applicable</span> <span class="nt">only</span> <span class="nt">for</span> <span class="nt">school</span> <span class="nt">aggregations</span><span class="o">.</span>
<span class="err">##</span> <span class="nt">6</span>   <span class="nt">County</span> <span class="nt">Name</span>                                                      
<span class="err">##</span>                                                                                                                                                                                            <span class="nt">valid_values</span>
<span class="err">##</span> <span class="nt">1</span>                                                                                                                                                                                                      
<span class="err">##</span> <span class="nt">2</span> <span class="nt">CDS</span> <span class="nt">codes</span> <span class="nt">for</span> <span class="nt">schools</span> <span class="nt">and</span> <span class="nt">districts</span><span class="err">\</span><span class="nt">nTHE</span> <span class="nt">FIRST</span> <span class="nt">TWO</span> <span class="nt">POSITIONS</span> <span class="nt">WILL</span> <span class="nt">INCLUDE</span> <span class="nt">THE</span> <span class="nt">FOLLOWING</span> <span class="nt">AGGREGATION</span> <span class="nt">CODES</span><span class="o">:</span> <span class="nt">NS</span> <span class="o">=</span> <span class="nt">Non-Special</span> <span class="nt">Needs</span><span class="o">;</span> <span class="nt">SN</span> <span class="o">=</span> <span class="nt">Special</span> <span class="nt">Needs</span><span class="o">;</span> <span class="nt">ST</span> <span class="o">=</span> <span class="nt">State</span><span class="o">;</span> <span class="nt">A</span> <span class="o">=</span> <span class="nt">DFG</span> <span class="nt">A</span><span class="o">;</span> <span class="nt">B</span> <span class="o">=</span> <span class="nt">DFG</span> <span class="nt">B</span><span class="o">;</span> <span class="nt">CD</span><span class="o">=</span> <span class="nt">DFG</span> <span class="nt">CD</span><span class="err">…</span><span class="o">.</span>
<span class="err">##</span> <span class="nt">3</span>                                                                                                    <span class="nt">01</span><span class="o">,</span> <span class="nt">03</span><span class="o">,</span> <span class="nt">05</span><span class="o">,</span> <span class="nt">07</span><span class="o">,</span> <span class="nt">09</span><span class="o">,</span> <span class="nt">11</span><span class="o">,</span> <span class="nt">13</span><span class="o">,</span> <span class="nt">15</span><span class="o">,</span> <span class="nt">17</span><span class="o">,</span> <span class="nt">19</span><span class="o">,</span> <span class="nt">21</span><span class="o">,</span> <span class="nt">23</span><span class="o">,</span> <span class="nt">25</span><span class="o">,</span> <span class="nt">27</span><span class="o">,</span> <span class="nt">29</span><span class="o">,</span> <span class="nt">31</span><span class="o">,</span> <span class="nt">33</span><span class="o">,</span> <span class="nt">35</span><span class="o">,</span> <span class="nt">37</span><span class="o">,</span> <span class="nt">39</span><span class="o">,</span> <span class="nt">41</span><span class="o">,</span> <span class="nt">43</span><span class="o">,</span> <span class="nt">45</span><span class="o">,</span> <span class="nt">47</span><span class="o">,</span> <span class="nt">80</span>
<span class="err">##</span> <span class="nt">4</span>                                                                                                                                                                                   <span class="nt">0100</span> <span class="nt">to</span> <span class="nt">9999</span><span class="o">,</span> <span class="nt">blank</span>
<span class="err">##</span> <span class="nt">5</span>                                                                                                                                                                                     <span class="nt">001</span> <span class="nt">to</span> <span class="nt">999</span><span class="o">,</span> <span class="nt">blank</span>
<span class="err">##</span> <span class="nt">6</span>                                                                                                                                  <span class="nt">A</span> <span class="nt">to</span> <span class="nt">Z</span><span class="o">,</span> <span class="nt">blank</span><span class="o">;</span>  <span class="nt">Applicable</span> <span class="nt">only</span> <span class="nt">for</span> <span class="nt">district</span> <span class="nt">and</span> <span class="nt">school</span> <span class="nt">aggregations</span>
<span class="err">##</span>   <span class="nt">spanner1</span> <span class="nt">spanner2</span>    <span class="nt">final_name</span>
<span class="err">##</span> <span class="nt">1</span>                      <span class="nt">RECORD_KEY</span>
<span class="err">##</span> <span class="nt">2</span>                        <span class="nt">CDS_Code</span>
<span class="err">##</span> <span class="nt">3</span>                     <span class="nt">County_Code</span>
<span class="err">##</span> <span class="nt">4</span>                   <span class="nt">District_Code</span>
<span class="err">##</span> <span class="nt">5</span>                     <span class="nt">School_Code</span>
<span class="err">##</span> <span class="nt">6</span>                     <span class="nt">County_Name</span>
</pre></div>


<p>Use the layout file to process an example HSPA data file:</p>
<div class="highlight"><pre>hspa_url <span class="o">&lt;-</span> <span class="s">&#39;http://www.state.nj.us/education/schools/achievement/14/hspa/state_summary.txt&#39;</span>

hspa_ex <span class="o">&lt;-</span> readr<span class="o">::</span>read_fwf<span class="p">(</span>
  file <span class="o">=</span> hspa_url<span class="p">,</span>
  col_positions <span class="o">=</span> readr<span class="o">::</span>fwf_positions<span class="p">(</span>
    start <span class="o">=</span> layout_hspa<span class="o">$</span>field_start_position<span class="p">,</span>
    end <span class="o">=</span> layout_hspa<span class="o">$</span>field_end_position<span class="p">,</span>
    col_names <span class="o">=</span> layout_hspa<span class="o">$</span>final_name
  <span class="p">),</span>
  na <span class="o">=</span> <span class="s">&quot;*&quot;</span>
<span class="p">)</span>

hspa_ex <span class="o">%&gt;%</span> <span class="kp">as.data.frame</span><span class="p">()</span> <span class="o">%&gt;%</span> select<span class="p">(</span>CDS_Code<span class="o">:</span>TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean<span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>##   CDS_Code County_Code District_Code School_Code County_Name
## 1       ST          ST            NA          NA            
## 2       SN          SN            NA          NA            
## 3   250100          25           100          NA    MONMOUTH
## 4   010110          01           110          NA    ATLANTIC
## 5   110540          11           540          NA  CUMBERLAND
## 6   010590          01           590          NA    ATLANTIC
##    District_Name School_Name DFG Special_Needs
## 1                                             
## 2                                             
## 3    ASBURY PARK               A             Y
## 4  ATLANTIC CITY               A              
## 5      BRIDGETON               A             Y
## 6 BUENA REGIONAL               A              
##   TOTAL_POPULATION_Number_Enrolled_LAL
## 1                                98240
## 2                                14584
## 3                                   73
## 4                                  377
## 5                                  268
## 6                                  173
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_Not_Present
## 1                                               507
## 2                                               165
## 3                                                 1
## 4                                                 7
## 5                                                 6
## 6                                                 0
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Voids
## 1                                            148
## 2                                             28
## 3                                              1
## 4                                              0
## 5                                              0
## 6                                              1
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Valid_Scale_Scores
## 1                                                       97091
## 2                                                       14315
## 3                                                          71
## 4                                                         370
## 5                                                         262
## 6                                                         172
##   TOTAL_POPULATION_LANGUAGE_ARTS_Partially_Proficient_Percentage
## 1                                                             67
## 2                                                            190
## 3                                                            366
## 4                                                            176
## 5                                                            149
## 6                                                             41
##   TOTAL_POPULATION_LANGUAGE_ARTS_Proficient_Percentage
## 1                                                  604
## 2                                                  708
## 3                                                  634
## 4                                                  630
## 5                                                  802
## 6                                                  802
##   TOTAL_POPULATION_LANGUAGE_ARTS_Advanced_Proficient_Percentage
## 1                                                           328
## 2                                                           103
## 3                                                             0
## 4                                                           195
## 5                                                            50
## 6                                                           157
##   TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean
## 1                                            2368
## 2                                            2201
## 3                                            2039
## 4                                            2254
## 5                                            2207
## 6                                            2320
</pre></div>


<p>That gets us to a similar state as we were in for the NJASK data - we have all the columns identified, but there's a need for post-processing, especially for the percentage columns, which have 'One implied decimal.'</p>
<p>We can take the formula we wrote to process NJASK data frames and generalize it, so that it can handle both NJASK and HSPA data.</p>
<div class="highlight"><pre>process_nj_assess <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>df<span class="p">,</span> layout<span class="p">)</span> <span class="p">{</span>
  <span class="kn">require</span><span class="p">(</span>Hmisc<span class="p">)</span>
  <span class="c1">#build a mask</span>
  mask <span class="o">&lt;-</span> layout<span class="o">$</span>comments <span class="o">==</span> <span class="s">&#39;One implied decimal&#39;</span>

  <span class="c1">#keep the names to put back in the same order</span>
  all_names <span class="o">&lt;-</span> <span class="kp">names</span><span class="p">(</span>df<span class="p">)</span>

  <span class="c1">#make sure df is data frame (not dplyr data frame) so that normal subsetting</span>
  df <span class="o">&lt;-</span> <span class="kp">as.data.frame</span><span class="p">(</span>df<span class="p">)</span>

  <span class="c1">#get name of last column and kill \n characters</span>
  last_col <span class="o">&lt;-</span> <span class="kp">names</span><span class="p">(</span>df<span class="p">)[</span><span class="kp">ncol</span><span class="p">(</span>df<span class="p">)]</span>
  df<span class="p">[,</span> last_col<span class="p">]</span> <span class="o">&lt;-</span> <span class="kp">gsub</span><span class="p">(</span><span class="s">&#39;\n&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> df<span class="p">[,</span> last_col<span class="p">],</span> fixed <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>

<span class="c1">#   #sigh, edge case in old HSPA data file where \n randomly exists in one middle column</span>
<span class="c1">#   if (&#39;SCIENCE_NON-ECONOMICALLY_DISADVANTAGED_Scale_Score_Mean&#39; %in% names(df)) {</span>
<span class="c1">#     df$SCIENCE_NON-ECONOMICALLY_DISADVANTAGED_Scale_Score_Mean &lt;- gsub(</span>
<span class="c1">#       &#39;\n&#39;, &#39;&#39;, df$SCIENCE_NON-ECONOMICALLY_DISADVANTAGED_Scale_Score_Mean, fixed = TRUE</span>
<span class="c1">#     )  </span>
<span class="c1">#   }</span>

  <span class="c1">#put some columns aside</span>
  ignore <span class="o">&lt;-</span> df<span class="p">[,</span> <span class="o">!</span>mask<span class="p">]</span>

  implied_decimal_fix <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
    <span class="c1">#strip out anything that&#39;s not a number.</span>
    x <span class="o">&lt;-</span> <span class="kp">as.numeric</span><span class="p">(</span><span class="kp">gsub</span><span class="p">(</span><span class="s">&quot;[^\\d]+&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> x<span class="p">,</span> perl<span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span>
    x <span class="o">/</span> <span class="m">10</span>
  <span class="p">}</span>

  <span class="c1">#process the columns that have an implied decimal</span>
  processed <span class="o">&lt;-</span> df<span class="p">[,</span> mask<span class="p">]</span> <span class="o">%&gt;%</span>
    dplyr<span class="o">::</span>mutate_each<span class="p">(</span>
      dplyr<span class="o">::</span>funs<span class="p">(</span>implied_decimal_fix<span class="p">)</span>  
    <span class="p">)</span>

  <span class="c1">#put back together </span>
  final <span class="o">&lt;-</span> <span class="kp">cbind</span><span class="p">(</span>ignore<span class="p">,</span> processed<span class="p">)</span>

  <span class="c1">#reorder and return</span>
  final <span class="o">%&gt;%</span>
    select<span class="p">(</span>
      one_of<span class="p">(</span><span class="kp">names</span><span class="p">(</span>df<span class="p">))</span>
    <span class="p">)</span>
<span class="p">}</span>

process_nj_assess<span class="p">(</span>hspa_ex<span class="p">,</span> layout_hspa<span class="p">)</span> <span class="o">%&gt;%</span> select<span class="p">(</span>CDS_Code<span class="o">:</span>TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean<span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>## Loading required package: Hmisc
</pre></div>


<div class="highlight"><pre>## Warning: package &#39;Hmisc&#39; was built under R version 3.1.3
</pre></div>


<div class="highlight"><pre>## Loading required package: grid
## Loading required package: lattice
## Loading required package: survival
## Loading required package: splines
## Loading required package: Formula
</pre></div>


<div class="highlight"><pre>## Warning: package &#39;Formula&#39; was built under R version 3.1.3
</pre></div>


<div class="highlight"><pre>## Loading required package: ggplot2
## 
## Attaching package: &#39;Hmisc&#39;
## 
## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     src, summarize
## 
## The following objects are masked from &#39;package:base&#39;:
## 
##     format.pval, round.POSIXt, trunc.POSIXt, units
</pre></div>


<div class="highlight"><pre>##   CDS_Code County_Code District_Code School_Code County_Name
## 1       ST          ST            NA          NA            
## 2       SN          SN            NA          NA            
## 3   250100          25           100          NA    MONMOUTH
## 4   010110          01           110          NA    ATLANTIC
## 5   110540          11           540          NA  CUMBERLAND
## 6   010590          01           590          NA    ATLANTIC
##    District_Name School_Name DFG Special_Needs
## 1                                             
## 2                                             
## 3    ASBURY PARK               A             Y
## 4  ATLANTIC CITY               A              
## 5      BRIDGETON               A             Y
## 6 BUENA REGIONAL               A              
##   TOTAL_POPULATION_Number_Enrolled_LAL
## 1                                98240
## 2                                14584
## 3                                   73
## 4                                  377
## 5                                  268
## 6                                  173
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_Not_Present
## 1                                               507
## 2                                               165
## 3                                                 1
## 4                                                 7
## 5                                                 6
## 6                                                 0
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Voids
## 1                                            148
## 2                                             28
## 3                                              1
## 4                                              0
## 5                                              0
## 6                                              1
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Valid_Scale_Scores
## 1                                                       97091
## 2                                                       14315
## 3                                                          71
## 4                                                         370
## 5                                                         262
## 6                                                         172
##   TOTAL_POPULATION_LANGUAGE_ARTS_Partially_Proficient_Percentage
## 1                                                            6.7
## 2                                                           19.0
## 3                                                           36.6
## 4                                                           17.6
## 5                                                           14.9
## 6                                                            4.1
##   TOTAL_POPULATION_LANGUAGE_ARTS_Proficient_Percentage
## 1                                                 60.4
## 2                                                 70.8
## 3                                                 63.4
## 4                                                 63.0
## 5                                                 80.2
## 6                                                 80.2
##   TOTAL_POPULATION_LANGUAGE_ARTS_Advanced_Proficient_Percentage
## 1                                                          32.8
## 2                                                          10.3
## 3                                                           0.0
## 4                                                          19.5
## 5                                                           5.0
## 6                                                          15.7
##   TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean
## 1                                           236.8
## 2                                           220.1
## 3                                           203.9
## 4                                           225.4
## 5                                           220.7
## 6                                           232.0
</pre></div>


<p>Yep, that totally works.  Following from the NJASK example, we'll write a function to simplify fetching the HSPA data, and a final wrapper around the fetch/process steps.</p>
<div class="highlight"><pre>get_raw_hspa <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>year<span class="p">,</span> layout<span class="o">=</span>layout_hspa<span class="p">)</span> <span class="p">{</span>
  <span class="kn">require</span><span class="p">(</span>readr<span class="p">)</span>

  <span class="c1">#url paths changed in 2012</span>
  years <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span>
    <span class="s">&quot;2014&quot;</span><span class="o">=</span><span class="s">&quot;14&quot;</span><span class="p">,</span> <span class="s">&quot;2013&quot;</span><span class="o">=</span><span class="s">&quot;13&quot;</span><span class="p">,</span> <span class="s">&quot;2012&quot;</span><span class="o">=</span><span class="s">&quot;2013&quot;</span><span class="p">,</span> <span class="s">&quot;2011&quot;</span><span class="o">=</span><span class="s">&quot;2012&quot;</span><span class="p">,</span> <span class="s">&quot;2010&quot;</span><span class="o">=</span><span class="s">&quot;2011&quot;</span><span class="p">,</span> <span class="s">&quot;2009&quot;</span><span class="o">=</span><span class="s">&quot;2010&quot;</span><span class="p">,</span> 
    <span class="s">&quot;2008&quot;</span><span class="o">=</span><span class="s">&quot;2009&quot;</span><span class="p">,</span> <span class="s">&quot;2007&quot;</span><span class="o">=</span><span class="s">&quot;2008&quot;</span><span class="p">,</span> <span class="s">&quot;2006&quot;</span><span class="o">=</span><span class="s">&quot;2007&quot;</span><span class="p">,</span> <span class="s">&quot;2005&quot;</span><span class="o">=</span><span class="s">&quot;2006&quot;</span><span class="p">,</span> <span class="s">&quot;2004&quot;</span><span class="o">=</span><span class="s">&quot;2005&quot;</span>
  <span class="p">)</span>
  parsed_year <span class="o">&lt;-</span> years<span class="p">[[</span><span class="kp">as.character</span><span class="p">(</span>year<span class="p">)]]</span>

  <span class="c1">#build url</span>
  target_url <span class="o">&lt;-</span> <span class="kp">paste0</span><span class="p">(</span>
    <span class="s">&quot;http://www.state.nj.us/education/schools/achievement/&quot;</span><span class="p">,</span> parsed_year<span class="p">,</span> 
    <span class="s">&quot;/hspa/state_summary.txt&quot;</span>
  <span class="p">)</span>

  <span class="c1">#read_fwf</span>
  df <span class="o">&lt;-</span> readr<span class="o">::</span>read_fwf<span class="p">(</span>
    file <span class="o">=</span> target_url<span class="p">,</span>
    col_positions <span class="o">=</span> readr<span class="o">::</span>fwf_positions<span class="p">(</span>
      start <span class="o">=</span> layout<span class="o">$</span>field_start_position<span class="p">,</span>
      end <span class="o">=</span> layout<span class="o">$</span>field_end_position<span class="p">,</span>
      col_names <span class="o">=</span> layout<span class="o">$</span>final_name
    <span class="p">),</span>
    na <span class="o">=</span> <span class="s">&quot;*&quot;</span>
  <span class="p">)</span>

  <span class="c1">#return df</span>
  <span class="kr">return</span><span class="p">(</span>df<span class="p">)</span>

<span class="p">}</span>

<span class="c1">#final wrapper</span>
fetch_hspa <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>year<span class="p">)</span> <span class="p">{</span>
  <span class="kr">if</span> <span class="p">(</span>year <span class="o">&gt;=</span> <span class="m">2011</span><span class="p">)</span> <span class="p">{</span>
    hspa_df <span class="o">&lt;-</span> get_raw_hspa<span class="p">(</span>year<span class="p">)</span> <span class="o">%&gt;%</span> process_nj_assess<span class="p">(</span>layout<span class="o">=</span>layout_hspa<span class="p">)</span>
  <span class="p">}</span> <span class="kr">else</span> <span class="kr">if</span> <span class="p">(</span>year <span class="o">&gt;=</span> <span class="m">2004</span><span class="p">)</span> <span class="p">{</span>
    hspa_df <span class="o">&lt;-</span> get_raw_hspa<span class="p">(</span>year<span class="p">,</span> layout<span class="o">=</span>layout_hspa2010<span class="p">)</span> <span class="o">%&gt;%</span> process_nj_assess<span class="p">(</span>layout<span class="o">=</span>layout_hspa2010<span class="p">)</span> 
  <span class="p">}</span>

  <span class="kr">return</span><span class="p">(</span>hspa_df<span class="p">)</span>
<span class="p">}</span>

fetch_hspa<span class="p">(</span><span class="m">2010</span><span class="p">)</span> <span class="o">%&gt;%</span> select<span class="p">(</span>CDS_Code<span class="o">:</span>TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean<span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>##    CDS_Code County_Code District_Code School_Code County_Name
## 1        ST          ST            NA          NA            
## 2        NS          NS            NA          NA            
## 3        SN          SN            NA          NA            
## 4         A           A            NA          NA            
## 5    250100          25           100          NA    MONMOUTH
## 6 250100010          25           100          10    MONMOUTH
##   District_Name      School_Name DFG Special_Needs
## 1                                                 
## 2                                                 
## 3                                                 
## 4                                                 
## 5   ASBURY PARK                    A             Y
## 6   ASBURY PARK ASBURY PARK H.S.   A             Y
##   TOTAL_POPULATION_Number_Enrolled_LAL
## 1                                99548
## 2                                85256
## 3                                14292
## 4                                11673
## 5                                  107
## 6                                  107
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_Not_Present
## 1                                               551
## 2                                               356
## 3                                               195
## 4                                               179
## 5                                                 1
## 6                                                 1
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Voids
## 1                                            199
## 2                                            126
## 3                                             73
## 4                                             64
## 5                                              0
## 6                                              0
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Valid_Scale_Scores
## 1                                                       98257
## 2                                                       84337
## 3                                                       13920
## 4                                                       11347
## 5                                                         103
## 6                                                         103
##   TOTAL_POPULATION_LANGUAGE_ARTS_Partially_Proficient_Percentage
## 1                                                           12.9
## 2                                                            9.2
## 3                                                           35.1
## 4                                                           37.4
## 5                                                           52.4
## 6                                                           52.4
##   TOTAL_POPULATION_LANGUAGE_ARTS_Proficient_Percentage
## 1                                                 68.7
## 2                                                 70.0
## 3                                                 60.6
## 4                                                 58.9
## 5                                                 47.6
## 6                                                 47.6
##   TOTAL_POPULATION_LANGUAGE_ARTS_Advanced_Proficient_Percentage
## 1                                                          18.4
## 2                                                          20.8
## 3                                                           4.3
## 4                                                           3.7
## 5                                                           0.0
## 6                                                           0.0
##   TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean
## 1                                           227.3
## 2                                           230.9
## 3                                           205.3
## 4                                           203.5
## 5                                           186.7
## 6                                           186.7
</pre></div>


<p>Nice!  NJASK and HSPA down, GEPA data to go.</p>
<h1>GEPA</h1>
<p>Load in the processed GEPA layout file:</p>
<div class="highlight"><pre><span class="kp">load</span><span class="p">(</span>file <span class="o">=</span> <span class="s">&#39;datasets/gepa_layout.rda&#39;</span><span class="p">)</span>

<span class="kp">head</span><span class="p">(</span>layout_gepa<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="err">##</span>   <span class="nt">field_start_position</span> <span class="nt">field_end_position</span> <span class="nt">field_length</span> <span class="nt">data_type</span>
<span class="err">##</span> <span class="nt">1</span>                    <span class="nt">1</span>                  <span class="nt">9</span>            <span class="nt">9</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">2</span>                    <span class="nt">1</span>                  <span class="nt">2</span>            <span class="nt">2</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">3</span>                    <span class="nt">3</span>                  <span class="nt">6</span>            <span class="nt">4</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">4</span>                    <span class="nt">7</span>                  <span class="nt">9</span>            <span class="nt">3</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">5</span>                   <span class="nt">10</span>                 <span class="nt">59</span>           <span class="nt">50</span>      <span class="nt">Text</span>
<span class="err">##</span> <span class="nt">6</span>                   <span class="nt">60</span>                <span class="nt">109</span>           <span class="nt">50</span>      <span class="nt">Text</span>
<span class="err">##</span>     <span class="nt">description</span> <span class="nt">comments</span>
<span class="err">##</span> <span class="nt">1</span>      <span class="nt">CDS</span> <span class="nt">Code</span>         
<span class="err">##</span> <span class="nt">2</span>   <span class="nt">County</span> <span class="nt">Code</span>         
<span class="err">##</span> <span class="nt">3</span> <span class="nt">District</span> <span class="nt">Code</span>         
<span class="err">##</span> <span class="nt">4</span>   <span class="nt">School</span> <span class="nt">Code</span>         
<span class="err">##</span> <span class="nt">5</span>   <span class="nt">County</span> <span class="nt">Name</span>         
<span class="err">##</span> <span class="nt">6</span> <span class="nt">District</span> <span class="nt">Name</span>         
<span class="err">##</span>                                                                                                                                                                                            <span class="nt">valid_values</span>
<span class="err">##</span> <span class="nt">1</span> <span class="nt">CDS</span> <span class="nt">codes</span> <span class="nt">for</span> <span class="nt">schools</span> <span class="nt">and</span> <span class="nt">districts</span><span class="err">\</span><span class="nt">nTHE</span> <span class="nt">FIRST</span> <span class="nt">TWO</span> <span class="nt">POSITIONS</span> <span class="nt">WILL</span> <span class="nt">INCLUDE</span> <span class="nt">THE</span> <span class="nt">FOLLOWING</span> <span class="nt">AGGREGATION</span> <span class="nt">CODES</span><span class="o">:</span> <span class="nt">NS</span> <span class="o">=</span> <span class="nt">Non-Special</span> <span class="nt">Needs</span><span class="o">;</span> <span class="nt">SN</span> <span class="o">=</span> <span class="nt">Special</span> <span class="nt">Needs</span><span class="o">;</span> <span class="nt">ST</span> <span class="o">=</span> <span class="nt">State</span><span class="o">;</span> <span class="nt">A</span> <span class="o">=</span> <span class="nt">DFG</span> <span class="nt">A</span><span class="o">;</span> <span class="nt">B</span> <span class="o">=</span> <span class="nt">DFG</span> <span class="nt">B</span><span class="o">;</span> <span class="nt">CD</span><span class="o">=</span> <span class="nt">DFG</span> <span class="nt">CD</span><span class="err">…</span><span class="o">.</span>
<span class="err">##</span> <span class="nt">2</span>                                                                     <span class="nt">01</span><span class="o">,</span> <span class="nt">03</span><span class="o">,</span> <span class="nt">05</span><span class="o">,</span> <span class="nt">07</span><span class="o">,</span> <span class="nt">09</span><span class="o">,</span> <span class="nt">11</span><span class="o">,</span> <span class="nt">13</span><span class="o">,</span> <span class="nt">15</span><span class="o">,</span> <span class="nt">17</span><span class="o">,</span> <span class="nt">19</span><span class="o">,</span> <span class="nt">21</span><span class="o">,</span> <span class="nt">23</span><span class="o">,</span> <span class="nt">25</span><span class="o">,</span> <span class="nt">27</span><span class="o">,</span> <span class="nt">29</span><span class="o">,</span> <span class="nt">31</span><span class="o">,</span> <span class="nt">33</span><span class="o">,</span> <span class="nt">35</span><span class="o">,</span> <span class="nt">37</span><span class="o">,</span> <span class="nt">39</span><span class="o">,</span> <span class="nt">41</span><span class="o">,</span> <span class="nt">80</span><span class="o">,</span> <span class="nt">ST</span><span class="o">,</span> <span class="nt">A</span><span class="o">,</span> <span class="nt">B</span><span class="o">,</span> <span class="nt">CD</span><span class="o">,</span> <span class="nt">DE</span><span class="o">,</span> <span class="nt">FG</span><span class="o">,</span> <span class="nt">GH</span><span class="o">,</span> <span class="nt">I</span><span class="o">,</span> <span class="nt">J</span><span class="o">,</span> <span class="nt">R</span><span class="o">,</span> <span class="nt">NS</span><span class="o">,</span> <span class="nt">SN</span>
<span class="err">##</span> <span class="nt">3</span>                                                                                                                                   <span class="nt">0100</span> <span class="nt">to</span> <span class="nt">9999</span><span class="o">;</span>  <span class="nt">Applicable</span> <span class="nt">only</span> <span class="nt">for</span> <span class="nt">district</span> <span class="nt">and</span> <span class="nt">school</span> <span class="nt">aggregations</span>
<span class="err">##</span> <span class="nt">4</span>                                                                                                                                                  <span class="nt">001</span> <span class="nt">to</span> <span class="nt">999</span><span class="o">;</span>  <span class="nt">Applicable</span> <span class="nt">only</span> <span class="nt">for</span> <span class="nt">school</span> <span class="nt">aggregations</span>
<span class="err">##</span> <span class="nt">5</span>                                                                                                                                  <span class="nt">A</span> <span class="nt">to</span> <span class="nt">Z</span><span class="o">,</span> <span class="nt">blank</span><span class="o">;</span>  <span class="nt">Applicable</span> <span class="nt">only</span> <span class="nt">for</span> <span class="nt">district</span> <span class="nt">and</span> <span class="nt">school</span> <span class="nt">aggregations</span>
<span class="err">##</span> <span class="nt">6</span>                                                                                                                                  <span class="nt">A</span> <span class="nt">to</span> <span class="nt">Z</span><span class="o">,</span> <span class="nt">blank</span><span class="o">;</span>  <span class="nt">Applicable</span> <span class="nt">only</span> <span class="nt">for</span> <span class="nt">district</span> <span class="nt">and</span> <span class="nt">school</span> <span class="nt">aggregations</span>
<span class="err">##</span>   <span class="nt">spanner1</span> <span class="nt">spanner2</span>    <span class="nt">final_name</span>
<span class="err">##</span> <span class="nt">1</span>                        <span class="nt">CDS_Code</span>
<span class="err">##</span> <span class="nt">2</span>                     <span class="nt">County_Code</span>
<span class="err">##</span> <span class="nt">3</span>                   <span class="nt">District_Code</span>
<span class="err">##</span> <span class="nt">4</span>                     <span class="nt">School_Code</span>
<span class="err">##</span> <span class="nt">5</span>                     <span class="nt">County_Name</span>
<span class="err">##</span> <span class="nt">6</span>                   <span class="nt">District_Name</span>
</pre></div>


<p>A function to get GEPA data:</p>
<div class="highlight"><pre>get_raw_gepa <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>year<span class="p">,</span> layout<span class="o">=</span>layout_gepa<span class="p">)</span> <span class="p">{</span>
  <span class="kn">require</span><span class="p">(</span>readr<span class="p">)</span>

  <span class="c1">#url paths changed in 2012</span>
  years <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span>
    <span class="s">&quot;2014&quot;</span><span class="o">=</span><span class="s">&quot;14&quot;</span><span class="p">,</span> <span class="s">&quot;2013&quot;</span><span class="o">=</span><span class="s">&quot;13&quot;</span><span class="p">,</span> <span class="s">&quot;2012&quot;</span><span class="o">=</span><span class="s">&quot;2013&quot;</span><span class="p">,</span> <span class="s">&quot;2011&quot;</span><span class="o">=</span><span class="s">&quot;2012&quot;</span><span class="p">,</span> <span class="s">&quot;2010&quot;</span><span class="o">=</span><span class="s">&quot;2011&quot;</span><span class="p">,</span> <span class="s">&quot;2009&quot;</span><span class="o">=</span><span class="s">&quot;2010&quot;</span><span class="p">,</span> 
    <span class="s">&quot;2008&quot;</span><span class="o">=</span><span class="s">&quot;2009&quot;</span><span class="p">,</span> <span class="s">&quot;2007&quot;</span><span class="o">=</span><span class="s">&quot;2008&quot;</span><span class="p">,</span> <span class="s">&quot;2006&quot;</span><span class="o">=</span><span class="s">&quot;2007&quot;</span><span class="p">,</span> <span class="s">&quot;2005&quot;</span><span class="o">=</span><span class="s">&quot;2006&quot;</span><span class="p">,</span> <span class="s">&quot;2004&quot;</span><span class="o">=</span><span class="s">&quot;2005&quot;</span>
  <span class="p">)</span>
  parsed_year <span class="o">&lt;-</span> years<span class="p">[[</span><span class="kp">as.character</span><span class="p">(</span>year<span class="p">)]]</span>

  <span class="c1">#build url</span>
  target_url <span class="o">&lt;-</span> <span class="kp">paste0</span><span class="p">(</span>
    <span class="s">&quot;http://www.state.nj.us/education/schools/achievement/&quot;</span><span class="p">,</span> parsed_year<span class="p">,</span> 
    <span class="s">&quot;/gepa/state_summary.txt&quot;</span>
  <span class="p">)</span>

  <span class="c1">#read_fwf</span>
  df <span class="o">&lt;-</span> readr<span class="o">::</span>read_fwf<span class="p">(</span>
    file <span class="o">=</span> target_url<span class="p">,</span>
    col_positions <span class="o">=</span> readr<span class="o">::</span>fwf_positions<span class="p">(</span>
      start <span class="o">=</span> layout<span class="o">$</span>field_start_position<span class="p">,</span>
      end <span class="o">=</span> layout<span class="o">$</span>field_end_position<span class="p">,</span>
      col_names <span class="o">=</span> layout<span class="o">$</span>final_name
    <span class="p">),</span>
    na <span class="o">=</span> <span class="s">&quot;*&quot;</span>
  <span class="p">)</span>

  <span class="c1">#return df</span>
  <span class="kr">return</span><span class="p">(</span>df<span class="p">)</span>

<span class="p">}</span>

gepa_ex <span class="o">&lt;-</span> get_raw_gepa<span class="p">(</span><span class="m">2007</span><span class="p">)</span>

gepa_ex <span class="o">%&gt;%</span> <span class="kp">as.data.frame</span><span class="p">()</span> <span class="o">%&gt;%</span> select<span class="p">(</span>CDS_Code<span class="o">:</span>TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean<span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>##    CDS_Code County_Code District_Code School_Code County_Name
## 1        ST          ST            NA          NA            
## 2        NS          NS            NA          NA            
## 3        SN          SN            NA          NA            
## 4         A           A            NA          NA            
## 5 250100000          25           100           0    MONMOUTH
## 6 250100070          25           100          70    MONMOUTH
##   District_Name      School_Name DFG_Flag
## 1                                        
## 2                                        
## 3                                        
## 4                                        
## 5   ASBURY PARK                         A
## 6   ASBURY PARK ASBURY PARK M.S.        A
##   Special_Needs_(Abbott)_district_flag TOTAL_POPULATION_Number_Enrolled
## 1                                                                108474
## 2                                                                 87774
## 3                                                                 20700
## 4                                                                 17401
## 5                                    Y                               NA
## 6                                    Y                               NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_Not_Present
## 1                                               667
## 2                                               371
## 3                                               296
## 4                                               264
## 5                                                NA
## 6                                                NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Voids
## 1                                           1262
## 2                                            668
## 3                                            594
## 4                                            509
## 5                                             NA
## 6                                             NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_APA
## 1                                          680
## 2                                          545
## 3                                          135
## 4                                          102
## 5                                           NA
## 6                                           NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Valid_Scale_Scores
## 1                                                      105865
## 2                                                       86190
## 3                                                       19675
## 4                                                       16526
## 5                                                          NA
## 6                                                          NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Partially_Proficient_Percentage
## 1                                                            264
## 2                                                            205
## 3                                                            522
## 4                                                            531
## 5                                                            715
## 6                                                            715
##   TOTAL_POPULATION_LANGUAGE_ARTS_Proficient_Percentage
## 1                                                  624
## 2                                                  663
## 3                                                  450
## 4                                                  442
## 5                                                  278
## 6                                                  278
##   TOTAL_POPULATION_LANGUAGE_ARTS_Advanced_Proficient_Percentage
## 1                                                           113
## 2                                                           132
## 3                                                            28
## 4                                                            27
## 5                                                             7
## 6                                                             7
##   TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean
## 1                                            2149
## 2                                            2193
## 3                                            1953
## 4                                            1946
## 5                                            1842
## 6                                            1842
</pre></div>


<p>Can we process the GEPA df using our existing function?</p>
<div class="highlight"><pre>process_nj_assess<span class="p">(</span>gepa_ex<span class="p">,</span> layout_gepa<span class="p">)</span> <span class="o">%&gt;%</span> select<span class="p">(</span>CDS_Code<span class="o">:</span>TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean<span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>##    CDS_Code County_Code District_Code School_Code County_Name
## 1        ST          ST            NA          NA            
## 2        NS          NS            NA          NA            
## 3        SN          SN            NA          NA            
## 4         A           A            NA          NA            
## 5 250100000          25           100           0    MONMOUTH
## 6 250100070          25           100          70    MONMOUTH
##   District_Name      School_Name DFG_Flag
## 1                                        
## 2                                        
## 3                                        
## 4                                        
## 5   ASBURY PARK                         A
## 6   ASBURY PARK ASBURY PARK M.S.        A
##   Special_Needs_(Abbott)_district_flag TOTAL_POPULATION_Number_Enrolled
## 1                                                                108474
## 2                                                                 87774
## 3                                                                 20700
## 4                                                                 17401
## 5                                    Y                               NA
## 6                                    Y                               NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_Not_Present
## 1                                               667
## 2                                               371
## 3                                               296
## 4                                               264
## 5                                                NA
## 6                                                NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Voids
## 1                                           1262
## 2                                            668
## 3                                            594
## 4                                            509
## 5                                             NA
## 6                                             NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_APA
## 1                                          680
## 2                                          545
## 3                                          135
## 4                                          102
## 5                                           NA
## 6                                           NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Valid_Scale_Scores
## 1                                                      105865
## 2                                                       86190
## 3                                                       19675
## 4                                                       16526
## 5                                                          NA
## 6                                                          NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Partially_Proficient_Percentage
## 1                                                           26.4
## 2                                                           20.5
## 3                                                           52.2
## 4                                                           53.1
## 5                                                           71.5
## 6                                                           71.5
##   TOTAL_POPULATION_LANGUAGE_ARTS_Proficient_Percentage
## 1                                                 62.4
## 2                                                 66.3
## 3                                                 45.0
## 4                                                 44.2
## 5                                                 27.8
## 6                                                 27.8
##   TOTAL_POPULATION_LANGUAGE_ARTS_Advanced_Proficient_Percentage
## 1                                                          11.3
## 2                                                          13.2
## 3                                                           2.8
## 4                                                           2.7
## 5                                                           0.7
## 6                                                           0.7
##   TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean
## 1                                           214.9
## 2                                           219.3
## 3                                           195.3
## 4                                           194.6
## 5                                           184.2
## 6                                           184.2
</pre></div>


<p>Yes, totally.<br />
Final step: write all of that into a final wrapper function:</p>
<div class="highlight"><pre><span class="c1">#final wrapper</span>
fetch_gepa <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>year<span class="p">)</span> <span class="p">{</span>
  get_raw_gepa<span class="p">(</span>year<span class="p">)</span> <span class="o">%&gt;%</span> process_nj_assess<span class="p">(</span>layout<span class="o">=</span>layout_gepa<span class="p">)</span>

<span class="p">}</span>

fetch_gepa<span class="p">(</span><span class="m">2007</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">as.data.frame</span><span class="p">()</span> <span class="o">%&gt;%</span> select<span class="p">(</span>CDS_Code<span class="o">:</span>TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean<span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>##    CDS_Code County_Code District_Code School_Code County_Name
## 1        ST          ST            NA          NA            
## 2        NS          NS            NA          NA            
## 3        SN          SN            NA          NA            
## 4         A           A            NA          NA            
## 5 250100000          25           100           0    MONMOUTH
## 6 250100070          25           100          70    MONMOUTH
##   District_Name      School_Name DFG_Flag
## 1                                        
## 2                                        
## 3                                        
## 4                                        
## 5   ASBURY PARK                         A
## 6   ASBURY PARK ASBURY PARK M.S.        A
##   Special_Needs_(Abbott)_district_flag TOTAL_POPULATION_Number_Enrolled
## 1                                                                108474
## 2                                                                 87774
## 3                                                                 20700
## 4                                                                 17401
## 5                                    Y                               NA
## 6                                    Y                               NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_Not_Present
## 1                                               667
## 2                                               371
## 3                                               296
## 4                                               264
## 5                                                NA
## 6                                                NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Voids
## 1                                           1262
## 2                                            668
## 3                                            594
## 4                                            509
## 5                                             NA
## 6                                             NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_APA
## 1                                          680
## 2                                          545
## 3                                          135
## 4                                          102
## 5                                           NA
## 6                                           NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Number_of_Valid_Scale_Scores
## 1                                                      105865
## 2                                                       86190
## 3                                                       19675
## 4                                                       16526
## 5                                                          NA
## 6                                                          NA
##   TOTAL_POPULATION_LANGUAGE_ARTS_Partially_Proficient_Percentage
## 1                                                           26.4
## 2                                                           20.5
## 3                                                           52.2
## 4                                                           53.1
## 5                                                           71.5
## 6                                                           71.5
##   TOTAL_POPULATION_LANGUAGE_ARTS_Proficient_Percentage
## 1                                                 62.4
## 2                                                 66.3
## 3                                                 45.0
## 4                                                 44.2
## 5                                                 27.8
## 6                                                 27.8
##   TOTAL_POPULATION_LANGUAGE_ARTS_Advanced_Proficient_Percentage
## 1                                                          11.3
## 2                                                          13.2
## 3                                                           2.8
## 4                                                           2.7
## 5                                                           0.7
## 6                                                           0.7
##   TOTAL_POPULATION_LANGUAGE_ARTS_Scale_Score_Mean
## 1                                           214.9
## 2                                           219.3
## 3                                           195.3
## 4                                           194.6
## 5                                           184.2
## 6                                           184.2
</pre></div>


<p>In the next post in this series, we'll take these individual NJASK, HSPA, and GEPA functions and write a wrapper to rule them all, allowing data to be easily fetched for any year/grade.</p></div>
	<hr>

	
</div>
		</div>
	</div>
</div>

<!-- FOOTER -->
<div class="container">
	<div class="row">
		<div class="col-md-11 text-center center-block aw-bottom">
			<p>almart.in is built with <a href="http://docs.getpelican.com/en/3.5.0/#">pelican</a></p>
		</div>
	</div>
</div>
<!-- JavaScript -->
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script type="text/javascript">
jQuery(document).ready(function($) {
	$("div.collapseheader").click(function () {
		$header = $(this).children("span").first();
		$codearea = $(this).children(".input_area");
		$codearea.slideToggle(500, function () {
			$header.text(function () {
				return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
			});
		});
	});
});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61809650-1', 'auto');
  ga('send', 'pageview');

</script>

 
</body>
</html>