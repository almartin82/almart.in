<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Getting NJ assessment data into R: part 3 in a series. â€” almart.in</title>
	<meta name="description" content="Title: Getting NJ assessment data into R: part 3 in a series.; Date: 2015-04-16; Author: Andrew Martin">
	<meta name="author" content="Andrew Martin">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="http://almart.in/theme/html5.js"></script>
		<![endif]-->
	<link href="http://almart.in/theme/css/ipython.css" rel="stylesheet">
	<!-- <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet"> -->
	<!-- <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"> -->
	<!-- <link href="//maxcdn.bootstrapcdn.com/bootswatch/3.2.0/simplex/bootstrap.min.css" rel="stylesheet"> -->
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/bootswatch/3.3.2/simplex/bootstrap.min.css" rel="stylesheet">
	<link href="http://almart.in/theme/css/local.css" rel="stylesheet">
	<link href="http://almart.in/theme/css/pygments.css" rel="stylesheet">
</head>
<body>
<div class="container">
	<!-- NAVBAR -->
	<nav class="navbar navbar-default" style="margin-top:2em;">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="http://almart.in">almart.in</a>
			</div>			
			<!-- MENUITEMS: update the MENUITEMS dict in pelicanconf.py -->
			<div id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav">
					<li><a href="http://almart.in/pages/about.html"><i class="fa fa-user "></i> about</a></li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li><a href="http://almart.in/categories.html"><i class="fa fa-archive"></i> categories</a></li>
					<li><a href="http://almart.in/tags.html"><i class="fa fa-tags"></i> tags</a></li>
					<li><a href="http://almart.in/feeds/all_atom.xml"><i class="fa fa-rss"></i> rss</a></li>
				</ul>
			</div>
		</div>
	</nav>
	
	<!-- MAIN CONTENT: edit in base_site.html template -->
	<div class="row">
		<div class="col-md-8 col-md-offset-2">
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="text-center article-header">
		<h1 itemprop="name headline" class="article-title">Getting NJ assessment data into R: part 3 in a series.</h1>
		<span>
			<div itemprop="author" itemscope itemtype="http://schema.org/Person">
				<span itemprop="name">Andrew Martin</span> 
				&nbsp;&#124;&nbsp;
				<time datetime="2015-04-16T00:00:00-04:00" itemprop="datePublished">April 16 2015</time>
				&nbsp;|&nbsp;
				<span><a href="http://almart.in/reading-nj-assess-data-3.txt" title="Raw Markdown for Getting NJ assessment data into R: part 3 in a series.">raw</a></span>
			</div>
		</span>
		
	</div>
	<div>
		category:
		<span itemprop="articleSection">
			<a href="http://almart.in/category/education.html" rel="category">education</a>
		</span>
	</div>
	
 
	<div>
		tags:
		<span itemprop="keywords">
			<a href="http://almart.in/tag/nj.html" rel="tag"> NJ</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/assessment.html" rel="tag"> assessment</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/njask.html" rel="tag"> NJASK</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/hspa.html" rel="tag"> HSPA</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/data_management.html" rel="tag"> data_management</a>&nbsp;&nbsp;
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/tutorial.html" rel="tag"> tutorial</a>&nbsp;&nbsp;
		</span>
	</div>
	<div itemprop="articleBody" class="article-body"><p>In my <a href="" title="/reading-nj-assess-data-2.html">last post</a>, I talked about how to programmatically process and cleanup NJASK data.  In this post, we'll extend the NJASK functions to the High School Proficiency Assessment (HSPA) and the old Grade Eight Proficiency Assessment (GEPA).</p>
<p>Roughly speaking, we want to:</p>
<ol>
<li>
<p>Check that call we made is a valid grade/year combination (raising an informative error if not)</p>
</li>
<li>
<p>Map the grade / year call to the correct <code>get_blank_data</code> function (NJASK? HSPA? GEPA?)</p>
</li>
<li>
<p>Fetch, clean, and return the data frame.</p>
</li>
</ol>
<p>But we're getting a little ahead of ourselves.  First we need to look more closely at the HSPA data, and write functions to get and process that data. </p>
<h1>HSPA</h1>
<div class="highlight"><pre>hspa_url <span class="o">&lt;-</span> <span class="s">&#39;http://www.state.nj.us/education/schools/achievement/14/hspa/state_summary.txt&#39;</span>

hspa_raw <span class="o">&lt;-</span> readr<span class="o">::</span>read_fwf<span class="p">(</span>
  file <span class="o">=</span> hspa_url
<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Error in structure(list(begin = begin, end = end, na = na), class = &quot;tokenizer_fwf&quot;): argument &quot;col_positions&quot; is missing, with no default
</pre></div>


<h1>GEPA</h1>
<h1>valid calls</h1>
<p>This function will test if a year/grade call is valid.</p>
<div class="highlight"><pre>valid_call <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>year<span class="p">,</span> grade<span class="p">)</span> <span class="p">{</span>
  <span class="c1">#common core transition started in 2015</span>
  <span class="kr">if</span><span class="p">(</span>year <span class="o">&gt;</span> <span class="m">2014</span><span class="p">)</span> <span class="p">{</span>
    valid_call <span class="o">&lt;-</span> <span class="kc">FALSE</span>
  <span class="c1">#NJASK fully implemented in 2008</span>
  <span class="p">}</span> <span class="kr">else</span> <span class="kr">if</span><span class="p">(</span>year <span class="o">&gt;=</span> <span class="m">2006</span><span class="p">)</span> <span class="p">{</span>
    valid_call <span class="o">&lt;-</span> grade <span class="o">%in%</span> <span class="kt">c</span><span class="p">(</span><span class="m">3</span><span class="o">:</span><span class="m">8</span><span class="p">,</span> <span class="m">11</span><span class="p">)</span>
  <span class="p">}</span> <span class="kr">else</span> <span class="kr">if</span> <span class="p">(</span>year <span class="o">&gt;=</span> <span class="m">2004</span><span class="p">)</span> <span class="p">{</span>
    valid_call <span class="o">&lt;-</span> grade <span class="o">%in%</span> <span class="kt">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">11</span><span class="p">)</span>
  <span class="p">}</span> <span class="kr">else</span> <span class="kr">if</span> <span class="p">(</span>year <span class="o">&lt;</span> <span class="m">2004</span><span class="p">)</span> <span class="p">{</span>
    valid_call <span class="o">&lt;-</span> <span class="kc">FALSE</span>
  <span class="p">}</span>

  <span class="kr">return</span><span class="p">(</span>valid_call<span class="p">)</span>

<span class="p">}</span>
</pre></div>


<h1>retrieval</h1>
<p>This function does normal retrieval (NJASK for 3-8; HSPA for 11).</p>
<div class="highlight"><pre>standard_assess <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>year<span class="p">,</span> grade<span class="p">)</span> <span class="p">{</span>
  <span class="kr">if</span><span class="p">(</span>grade <span class="o">%in%</span> <span class="kt">c</span><span class="p">(</span><span class="m">3</span><span class="o">:</span><span class="m">8</span><span class="p">))</span> <span class="p">{</span>
    assess_data <span class="o">&lt;-</span> get_raw_njask<span class="p">(</span>year<span class="p">,</span> grade<span class="p">)</span> <span class="o">%&gt;%</span>
      process_njask<span class="p">()</span>
  <span class="p">}</span> <span class="kr">else</span> <span class="kr">if</span> <span class="p">(</span>grade <span class="o">==</span> <span class="m">11</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">#not yet implemented</span>
    assess_data <span class="o">&lt;-</span> get_raw_hspa<span class="p">(</span>year<span class="p">)</span> <span class="o">%&gt;%</span>
      process_hspa
  <span class="p">}</span>

  <span class="kr">return</span><span class="p">(</span>assess_data<span class="p">)</span>
<span class="p">}</span> 
</pre></div>


<p>Here is a mapping function that calls the correct retrieval method, given grade and year.</p>
<div class="highlight"><pre>fetch_nj_assess <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>year<span class="p">,</span> grade<span class="p">)</span> <span class="p">{</span>

  is_valid <span class="o">&lt;-</span> valid_call<span class="p">(</span>year<span class="p">,</span> grade<span class="p">)</span>

  <span class="kr">if</span> <span class="p">(</span>year <span class="o">&gt;=</span> <span class="m">2008</span><span class="p">)</span> <span class="p">{</span>
    assess_data <span class="o">&lt;-</span> standard_assess<span class="p">(</span>year<span class="p">,</span> grade<span class="p">)</span>
  <span class="c1">#2006 and 2007: NJASK 3rd-7th, GEPA 8th, HSPA 11th</span>
  <span class="p">}</span> <span class="kr">else</span> <span class="kr">if</span> <span class="p">(</span>year <span class="o">%in%</span> <span class="kt">c</span><span class="p">(</span><span class="m">2006</span><span class="p">,</span> <span class="m">2007</span><span class="p">))</span> <span class="p">{</span>
    <span class="kr">if</span> <span class="p">(</span>grade <span class="o">%in%</span> <span class="kt">c</span><span class="p">(</span><span class="m">3</span><span class="o">:</span><span class="m">7</span><span class="p">))</span> <span class="p">{</span>
      assess_data <span class="o">&lt;-</span> standard_assess<span class="p">(</span>year<span class="p">,</span> grade<span class="p">)</span>  
    <span class="p">}</span> <span class="kr">else</span> <span class="kr">if</span> <span class="p">(</span>grade <span class="o">==</span> <span class="m">8</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">#not yet implemented</span>
      assess_data <span class="o">&lt;-</span> get_raw_gepa<span class="p">(</span>year<span class="p">)</span> <span class="o">%&gt;%</span>
        process_gepa<span class="p">()</span>
    <span class="p">}</span> <span class="kr">else</span> <span class="kr">if</span> <span class="p">(</span>grade <span class="o">==</span> <span class="m">11</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">#not yet implemented</span>
      assess_data <span class="o">&lt;-</span> get_raw_hspa<span class="p">(</span>year<span class="p">)</span> <span class="o">%&gt;%</span>
        process_hspa
    <span class="p">}</span>
  <span class="c1">#2004 and 2005:  NJASK 3rd &amp; 4th, GEPA 8th, HSPA 11th</span>
  <span class="p">}</span> <span class="kr">else</span> <span class="kr">if</span> <span class="p">(</span>year <span class="o">%in%</span> <span class="kt">c</span><span class="p">(</span><span class="m">2004</span><span class="p">,</span> <span class="m">2005</span><span class="p">))</span> <span class="p">{</span>
    <span class="kr">if</span> <span class="p">(</span>grade <span class="o">%in%</span> <span class="kt">c</span><span class="p">(</span><span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">))</span> <span class="p">{</span>
      assess_data <span class="o">&lt;-</span> standard_assess<span class="p">(</span>year<span class="p">,</span> grade<span class="p">)</span>  
    <span class="p">}</span> <span class="kr">else</span> <span class="kr">if</span> <span class="p">(</span>grade <span class="o">==</span> <span class="m">8</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">#not yet implemented</span>
      assess_data <span class="o">&lt;-</span> get_raw_gepa<span class="p">(</span>year<span class="p">)</span> <span class="o">%&gt;%</span>
        process_gepa<span class="p">()</span>
    <span class="p">}</span> <span class="kr">else</span> <span class="kr">if</span> <span class="p">(</span>grade <span class="o">==</span> <span class="m">11</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">#not yet implemented</span>
      assess_data <span class="o">&lt;-</span> get_raw_hspa<span class="p">(</span>year<span class="p">)</span> <span class="o">%&gt;%</span>
        process_hspa 
    <span class="p">}</span>
  <span class="c1"># if we ever reached this block, there&#39;s a problem with our `valid_call()` function</span>
  <span class="p">}</span> <span class="kr">else</span> <span class="p">{</span>
    <span class="c1">#raise an error</span>
  <span class="p">}</span>

  <span class="kr">return</span><span class="p">(</span>assess_data<span class="p">)</span>
<span class="p">}</span>

fetch_nj_assess<span class="p">(</span><span class="m">2014</span><span class="p">,</span> <span class="m">6</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span class="err">##</span> <span class="nb">Error</span> <span class="k">in</span> <span class="nb">eval</span><span class="p">(</span><span class="nx">expr</span><span class="p">,</span> <span class="nx">envir</span><span class="p">,</span> <span class="nx">enclos</span><span class="p">)</span><span class="o">:</span> <span class="nx">could</span> <span class="nx">not</span> <span class="nx">find</span> <span class="kd">function</span> <span class="s2">&quot;%&gt;%&quot;</span>
</pre></div>


<p>Finally, as a convenience, let's write a function that brings down all of the NJASK data for all years and grades.</p></div>
	<hr>

	
</div>
		</div>
	</div>
</div>

<!-- FOOTER -->
<div class="container">
	<div class="row">
		<div class="col-md-11 text-center center-block aw-bottom">
			<p>almart.in is built with <a href="http://docs.getpelican.com/en/3.5.0/#">pelican</a></p>
		</div>
	</div>
</div>
<!-- JavaScript -->
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script type="text/javascript">
jQuery(document).ready(function($) {
	$("div.collapseheader").click(function () {
		$header = $(this).children("span").first();
		$codearea = $(this).children(".input_area");
		$codearea.slideToggle(500, function () {
			$header.text(function () {
				return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
			});
		});
	});
});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61809650-1', 'auto');
  ga('send', 'pageview');

</script>

 
</body>
</html>