<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Working with NJASK data in R: part 1 in a series. â€” almart.in</title>
	<meta name="description" content="Title: Working with NJASK data in R: part 1 in a series.; Date: 2015-04-10; Author: Andrew Martin">
	<meta name="author" content="Andrew Martin">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="http://almart.in/theme/html5.js"></script>
		<![endif]-->
	<link href="http://almart.in/theme/css/ipython.css" rel="stylesheet">
	<!-- <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet"> -->
	<!-- <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"> -->
	<!-- <link href="//maxcdn.bootstrapcdn.com/bootswatch/3.2.0/simplex/bootstrap.min.css" rel="stylesheet"> -->
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="//maxcdn.bootstrapcdn.com/bootswatch/3.3.2/simplex/bootstrap.min.css" rel="stylesheet">
	<link href="http://almart.in/theme/css/local.css" rel="stylesheet">
	<link href="http://almart.in/theme/css/pygments.css" rel="stylesheet">
</head>
<body>
<div class="container">
	<!-- NAVBAR -->
	<nav class="navbar navbar-default" style="margin-top:2em;">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="http://almart.in">almart.in</a>
			</div>			
			<!-- MENUITEMS: update the MENUITEMS dict in pelicanconf.py -->
			<div id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav">
					<li><a href="http://almart.in/pages/about.html"><i class="fa fa-user "></i> about</a></li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li><a href="http://almart.in/categories.html"><i class="fa fa-archive"></i> categories</a></li>
					<li><a href="http://almart.in/tags.html"><i class="fa fa-tags"></i> tags</a></li>
					<li><a href="http://almart.in/feeds/all_rss.xml"><i class="fa fa-rss"></i> rss</a></li>
				</ul>
			</div>
		</div>
	</nav>
	
	<!-- MAIN CONTENT: edit in base_site.html template -->
	<div class="row">
		<div class="col-md-8 col-md-offset-2">
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="text-center article-header">
		<h1 itemprop="name headline" class="article-title">Working with NJASK data in R: part 1 in a series.</h1>
		<span>
			<div itemprop="author" itemscope itemtype="http://schema.org/Person">
				<span itemprop="name">Andrew Martin</span> 
				&nbsp;&#124;&nbsp;
				<time datetime="2015-04-10T00:00:00" itemprop="datePublished">April 10 2015</time>
				&nbsp;|&nbsp;
				<span><a href="http://almart.in/reading-njask-data-1.txt" title="Raw Markdown for Working with NJASK data in R: part 1 in a series.">raw</a></span>
			</div>
		</span>
		
	</div>
	<div>
		category:
		<span itemprop="articleSection">
			<a href="http://almart.in/category/education.html" rel="category">education</a>
		</span>
	</div>
	
 
	<div>
		tags:
		<span itemprop="keywords">
			<a href="http://almart.in/tag/nj.html" rel="tag">NJ</a>
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/njask.html" rel="tag">NJASK</a>
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/data_management.html" rel="tag">data_management</a>
		</span>
		<span itemprop="keywords">
			<a href="http://almart.in/tag/technical.html" rel="tag">technical</a>
		</span>
	</div>
	<div itemprop="articleBody" class="article-body"><p>New Jersey has switched over to the PARCC assessment, but from roughly 2005-2014 New Jersey took the "New Jersey Assessment of Skills and Knowledge," or more simply "the NJASK."</p>
<p>This data is a bit of a pain to work with.  There's a page for each <a href="http://www.state.nj.us/education/schools/achievement/14/">year</a> of assessment data, and for each year there's a <a href="http://www.state.nj.us/education/schools/achievement/14/njask8/">page</a> per grade level.  But wait!  It gets better!  If you download the Excel spreadsheet for each grade level (helpfully titled <code>state_summary.xls</code> for <em>every</em> year and grade!), you'll find <strong>5</strong> tabs per file, because there are simply too many demographic/subject subgroups for Excel 2003 to handle.</p>
<p><img src="/content/static_images/04_njask_excel.png"></p>
<p>I would like to say that I never go down this road, but looking at my downloads folder, I'm apparently on <code>state_summary(15).xls</code>.  </p>
<p>Yuck.</p>
<h1>there must be a better way</h1>
<p>Fortunately the state publishes <a href="http://www.state.nj.us/education/schools/achievement/14/njask8/state_summary.txt">fixed width</a> versions of these files that you can work with.  They're a little intimidating at first, but they're actually (relatively) easy to read into R.</p>
<h2><i class="fa fa-music"></i> welcome to the <a href="https://barryrowlingson.github.io/hadleyverse/#1">Hadleyverse </a><i class="fa fa-music"></i></h2>
<p>We can use the <code>read_fwf()</code> function from <a href="https://github.com/hadley/readr"><code>hadley/readr</code></a> to quickly read fixed width files into R.</p>
<p>First let's load some libraries:</p>
<div class="highlight"><pre>library<span class="p">(</span>readr<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Warning: package &#39;readr&#39; was built under R version 3.1.3
</pre></div>


<div class="highlight"><pre>library<span class="p">(</span>dplyr<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## 
## Attaching package: &#39;dplyr&#39;
## 
## The following object is masked from &#39;package:stats&#39;:
## 
##     filter
## 
## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union
</pre></div>


<div class="highlight"><pre>library<span class="p">(</span>sqldf<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Warning: package &#39;sqldf&#39; was built under R version 3.1.3
</pre></div>


<div class="highlight"><pre>## Loading required package: gsubfn
</pre></div>


<div class="highlight"><pre>## Warning: package &#39;gsubfn&#39; was built under R version 3.1.3
</pre></div>


<div class="highlight"><pre>## Loading required package: proto
## Loading required package: RSQLite
</pre></div>


<div class="highlight"><pre>## Warning: package &#39;RSQLite&#39; was built under R version 3.1.3
</pre></div>


<div class="highlight"><pre>## Loading required package: DBI
</pre></div>


<div class="highlight"><pre>library<span class="p">(</span>reshape2<span class="p">)</span>
library<span class="p">(</span>magrittr<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>sample_file <span class="o">=</span> <span class="s">&quot;http://www.state.nj.us/education/schools/achievement/14/njask8/state_summary.txt&quot;</span>

njask14_gr8 <span class="o">&lt;-</span> readr<span class="o">::</span>read_fwf<span class="p">(</span>
  file <span class="o">=</span> sample_file<span class="p">,</span>
  col_positions <span class="o">=</span> readr<span class="o">::</span>fwf_empty<span class="p">(</span>file<span class="o">=</span>sample_file<span class="p">)</span>
<span class="p">)</span>
head<span class="p">(</span>njask14_gr8<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Source: local data frame [6 x 244]
## 
##                  X1          X2                        X3 X4      X5  X6
## 1                ST                                           104616 308
## 2                NS                                            85260 218
## 3                SN                                            19356  90
## 4                 A                                            16599  77
## 5 250100   MONMOUTH ASBURY PARK                            A Y   129   1
## 6 250100070MONMOUTH ASBURY PARK ASBURY PARK MIDDLE SCHOOL  A Y   128   1
## Variables not shown: X7 (chr), X8 (chr), X9 (chr), X10 (chr), X11 (chr),
##   X12 (chr), X13 (chr), X14 (chr), X15 (chr), X16 (chr), X17 (chr), X18
##   (chr), X19 (chr), X20 (chr), X21 (chr), X22 (chr), X23 (chr), X24 (chr),
##   X25 (chr), X26 (chr), X27 (chr), X28 (chr), X29 (chr), X30 (chr), X31
##   (chr), X32 (chr), X33 (chr), X34 (chr), X35 (chr), X36 (chr), X37 (chr),
##   X38 (chr), X39 (chr), X40 (chr), X41 (chr), X42 (chr), X43 (chr), X44
##   (chr), X45 (chr), X46 (chr), X47 (chr), X48 (chr), X49 (chr), X50 (chr),
##   X51 (chr), X52 (chr), X53 (chr), X54 (chr), X55 (chr), X56 (chr), X57
##   (chr), X58 (chr), X59 (chr), X60 (chr), X61 (chr), X62 (chr), X63 (chr),
##   X64 (chr), X65 (chr), X66 (chr), X67 (chr), X68 (chr), X69 (chr), X70
##   (chr), X71 (chr), X72 (chr), X73 (chr), X74 (chr), X75 (chr), X76 (chr),
##   X77 (chr), X78 (chr), X79 (chr), X80 (chr), X81 (chr), X82 (chr), X83
##   (chr), X84 (chr), X85 (chr), X86 (chr), X87 (chr), X88 (chr), X89 (chr),
##   X90 (chr), X91 (chr), X92 (chr), X93 (chr), X94 (chr), X95 (chr), X96
##   (chr), X97 (chr), X98 (chr), X99 (chr), X100 (chr), X101 (chr), X102
##   (chr), X103 (chr), X104 (chr), X105 (chr), X106 (chr), X107 (chr), X108
##   (chr), X109 (chr), X110 (chr), X111 (chr), X112 (chr), X113 (chr), X114
##   (chr), X115 (chr), X116 (chr), X117 (chr), X118 (chr), X119 (chr), X120
##   (chr), X121 (chr), X122 (chr), X123 (chr), X124 (chr), X125 (chr), X126
##   (chr), X127 (chr), X128 (chr), X129 (chr), X130 (chr), X131 (chr), X132
##   (chr), X133 (chr), X134 (chr), X135 (chr), X136 (chr), X137 (chr), X138
##   (chr), X139 (chr), X140 (chr), X141 (chr), X142 (chr), X143 (chr), X144
##   (chr), X145 (chr), X146 (chr), X147 (chr), X148 (chr), X149 (chr), X150
##   (chr), X151 (chr), X152 (chr), X153 (chr), X154 (chr), X155 (chr), X156
##   (chr), X157 (chr), X158 (chr), X159 (chr), X160 (chr), X161 (chr), X162
##   (chr), X163 (chr), X164 (chr), X165 (chr), X166 (chr), X167 (chr), X168
##   (chr), X169 (chr), X170 (chr), X171 (chr), X172 (chr), X173 (chr), X174
##   (chr), X175 (chr), X176 (chr), X177 (chr), X178 (chr), X179 (chr), X180
##   (chr), X181 (chr), X182 (chr), X183 (chr), X184 (chr), X185 (chr), X186
##   (chr), X187 (chr), X188 (chr), X189 (chr), X190 (chr), X191 (chr), X192
##   (chr), X193 (chr), X194 (chr), X195 (chr), X196 (chr), X197 (chr), X198
##   (chr), X199 (chr), X200 (chr), X201 (chr), X202 (chr), X203 (chr), X204
##   (chr), X205 (chr), X206 (chr), X207 (chr), X208 (chr), X209 (chr), X210
##   (chr), X211 (chr), X212 (chr), X213 (chr), X214 (chr), X215 (chr), X216
##   (chr), X217 (chr), X218 (chr), X219 (chr), X220 (chr), X221 (chr), X222
##   (chr), X223 (chr), X224 (chr), X225 (chr), X226 (chr), X227 (chr), X228
##   (chr), X229 (chr), X230 (chr), X231 (chr), X232 (int), X233 (int), X234
##   (int), X235 (int), X236 (int), X237 (int), X238 (int), X239 (int), X240
##   (int), X241 (int), X242 (int), X243 (int), X244 (int)
</pre></div>


<p>So that's a start, but that gives us a bunch of weird unhelpful column names.  Also, there's a bunch of weird * characters.</p>
<h1>this part is unfortunate</h1>
<p>For whatever reason NJ has seen fit to publish the crucial <em>definitions</em> (column headers) for that data in an Excel spreadsheet.  Never in my life have I seen something <em>more</em> clearly suited for JSON.  </p>
<p><img src="/content/static_images/04_njask_layout.png"></p>
<p>I think we can do some dplyr tricks and recover the nested aspects of this data:</p>
<div class="highlight"><pre>layout <span class="o">&lt;-</span> readr<span class="o">::</span>read_csv<span class="p">(</span><span class="s">&quot;/content/datasets/njask_layout.csv&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Error: &#39;/content/datasets/njask_layout.csv&#39; does not exist.
</pre></div>


<div class="highlight"><pre>head<span class="p">(</span>layout<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>##                                                                       
## 1 function (mat, widths = rep.int(1, ncol(mat)), heights = rep.int(1, 
## 2     nrow(mat)), respect = FALSE)                                    
## 3 {                                                                   
## 4     storage.mode(mat) &lt;- &quot;integer&quot;                                  
## 5     mat &lt;- as.matrix(mat)                                           
## 6     if (!is.logical(respect)) {
</pre></div>


<div class="highlight"><pre>names<span class="p">(</span>layout<span class="p">)</span> <span class="o">&lt;-</span> tolower<span class="p">(</span>gsub<span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">,</span> names<span class="p">(</span>layout<span class="p">)))</span>
</pre></div>


<div class="highlight"><pre>## Error in names(layout) &lt;- tolower(gsub(&quot; &quot;, &quot;_&quot;, names(layout))): names() applied to a non-vector
</pre></div>


<p>In Excel I created a simple column to test if a column was a 'spanning' column (basically, was it merged across multiple columns).  First we'll separate those 'spanners' from the non-spanners.</p>
<div class="highlight"><pre>spanners <span class="o">&lt;-</span> dplyr<span class="o">::</span>filter<span class="p">(</span>layout<span class="p">,</span> structural<span class="o">==</span><span class="kc">TRUE</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Error in UseMethod(&quot;filter_&quot;): no applicable method for &#39;filter_&#39; applied to an object of class &quot;function&quot;
</pre></div>


<div class="highlight"><pre>keepers <span class="o">&lt;-</span> dplyr<span class="o">::</span>filter<span class="p">(</span>layout<span class="p">,</span> structural<span class="o">==</span><span class="kc">FALSE</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Error in UseMethod(&quot;filter_&quot;): no applicable method for &#39;filter_&#39; applied to an object of class &quot;function&quot;
</pre></div>


<div class="highlight"><pre>head<span class="p">(</span>spanners<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Error in head(spanners): object &#39;spanners&#39; not found
</pre></div>


<p>To match spanners with keepers, we can do a SQL join (dplyr doesn't join on inequalities <a href="https://github.com/hadley/dplyr/issues/557">yet</a>).</p>
<div class="highlight"><pre>with_spanners <span class="o">&lt;-</span> sqldf<span class="p">(</span><span class="s">&#39;</span>
<span class="s">  SELECT keepers.*</span>
<span class="s">        ,spanners.data_type AS spanner</span>
<span class="s">        ,spanners.field_length AS spanner_length</span>
<span class="s">  FROM keepers</span>
<span class="s">  LEFT OUTER JOIN spanners</span>
<span class="s">    ON keepers.field_start_position &gt;= spanners.field_start_position</span>
<span class="s">   AND keepers.field_end_position &lt;= spanners.field_end_position</span>
<span class="s">&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Loading required package: tcltk
</pre></div>


<div class="highlight"><pre>## Error in sqliteSendQuery(con, statement, bind.data): error in statement: no such table: keepers
</pre></div>


<div class="highlight"><pre>with_spanners<span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">20</span><span class="p">,</span> c<span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="m">8</span><span class="o">:</span><span class="m">10</span><span class="p">)]</span>
</pre></div>


<div class="highlight"><pre>## Error in eval(expr, envir, enclos): object &#39;with_spanners&#39; not found
</pre></div>


<p>So we have fields matched with their parents, but the sql join leaves us with long data, and we really need wide data (one row per field).  Let's reshape!</p>
<p>First let's tag each row with a row number:</p>
<div class="highlight"><pre>with_rn <span class="o">&lt;-</span> with_spanners <span class="o">%&gt;%</span>
  dplyr<span class="o">::</span>group_by<span class="p">(</span>
     field_start_position<span class="p">,</span> field_end_position<span class="p">,</span> field_length<span class="p">,</span> 
     data_type<span class="p">,</span> description<span class="p">,</span> comments<span class="p">,</span> valid_values  
  <span class="p">)</span> <span class="o">%&gt;%</span>
  mutate<span class="p">(</span>
    rn <span class="o">=</span> order<span class="p">(</span>desc<span class="p">(</span>spanner_length<span class="p">))</span> 
  <span class="p">)</span> <span class="o">%&gt;%</span>
  select<span class="p">(</span>
    field_start_position<span class="p">,</span> field_end_position<span class="p">,</span> field_length<span class="p">,</span> 
    data_type<span class="p">,</span> description<span class="p">,</span> comments<span class="p">,</span> valid_values<span class="p">,</span> spanner<span class="p">,</span> rn
  <span class="p">)</span> <span class="o">%&gt;%</span>
  as.data.frame<span class="p">()</span>
</pre></div>


<div class="highlight"><pre>## Error in eval(expr, envir, enclos): object &#39;with_spanners&#39; not found
</pre></div>


<div class="highlight"><pre>with_rn<span class="o">$</span>rn <span class="o">&lt;-</span> paste0<span class="p">(</span><span class="s">&#39;spanner&#39;</span><span class="p">,</span> with_rn<span class="o">$</span>rn<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Error in paste0(&quot;spanner&quot;, with_rn$rn): object &#39;with_rn&#39; not found
</pre></div>


<div class="highlight"><pre><span class="c1">#mask NAS</span>
with_rn<span class="o">$</span>spanner <span class="o">&lt;-</span> ifelse<span class="p">(</span>is.na<span class="p">(</span>with_rn<span class="o">$</span>spanner<span class="p">),</span><span class="s">&#39;&#39;</span><span class="p">,</span> with_rn<span class="o">$</span>spanner<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Error in ifelse(is.na(with_rn$spanner), &quot;&quot;, with_rn$spanner): object &#39;with_rn&#39; not found
</pre></div>


<div class="highlight"><pre>head<span class="p">(</span>with_rn<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Error in head(with_rn): object &#39;with_rn&#39; not found
</pre></div>


<p>Using that row number as a key, we can pivot and move each of those spanner values to a new column, using one of the many tools in the <code>reshape2</code> <a href="http://www.cookbook-r.com/Manipulating_data/Converting_data_between_wide_and_long_format/#from-long-to-wide">toolbox</a>.</p>
<div class="highlight"><pre>layout_wide <span class="o">&lt;-</span> dcast<span class="p">(</span>
  data <span class="o">=</span> with_rn<span class="p">,</span>
  formula <span class="o">=</span> field_start_position <span class="o">+</span> field_end_position <span class="o">+</span> field_length <span class="o">+</span>
    data_type <span class="o">+</span> description <span class="o">+</span> comments <span class="o">+</span> valid_values <span class="o">~</span> rn<span class="p">,</span>
  value.var <span class="o">=</span> <span class="s">&quot;spanner&quot;</span>
<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Error in match(x, table, nomatch = 0L): object &#39;with_rn&#39; not found
</pre></div>


<div class="highlight"><pre><span class="c1">#this appears to be a bug in dcast?  should not be needed.</span>
layout_wide<span class="o">$</span>spanner2 <span class="o">&lt;-</span> ifelse<span class="p">(</span>is.na<span class="p">(</span>layout_wide<span class="o">$</span>spanner2<span class="p">),</span><span class="s">&#39;&#39;</span><span class="p">,</span> layout_wide<span class="o">$</span>spanner2<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Error in ifelse(is.na(layout_wide$spanner2), &quot;&quot;, layout_wide$spanner2): object &#39;layout_wide&#39; not found
</pre></div>


<div class="highlight"><pre>layout_wide<span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">20</span><span class="p">,</span> <span class="p">]</span>
</pre></div>


<div class="highlight"><pre>## Error in eval(expr, envir, enclos): object &#39;layout_wide&#39; not found
</pre></div>


<p>Success!  Now we just concatenate <code>description</code>, <code>spanner1</code>, and <code>spanner2</code> into a single value, do a little cleanup, and we have our headers.</p>
<div class="highlight"><pre>layout_wide<span class="o">$</span>final_name <span class="o">&lt;-</span> layout_wide <span class="o">%$%</span> paste<span class="p">(</span>spanner1<span class="p">,</span> spanner2<span class="p">,</span> description<span class="p">,</span> sep<span class="o">=</span><span class="s">&#39;_&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Error in eval(expr, envir, enclos): object &#39;layout_wide&#39; not found
</pre></div>


<div class="highlight"><pre><span class="c1">#kill double underscores</span>
layout_wide<span class="o">$</span>final_name <span class="o">&lt;-</span> gsub<span class="p">(</span><span class="s">&#39;__&#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">,</span> layout_wide<span class="o">$</span>final_name<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Error in gsub(&quot;__&quot;, &quot;_&quot;, layout_wide$final_name): object &#39;layout_wide&#39; not found
</pre></div>


<div class="highlight"><pre><span class="c1">#kill leading or trailer underscores</span>
layout_wide<span class="o">$</span>final_name <span class="o">&lt;-</span> gsub<span class="p">(</span><span class="s">&quot;(^_+|_+$)&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> layout_wide<span class="o">$</span>final_name<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Error in gsub(&quot;(^_+|_+$)&quot;, &quot;&quot;, layout_wide$final_name): object &#39;layout_wide&#39; not found
</pre></div>


<div class="highlight"><pre><span class="c1">#all whitespace becomes underscore</span>
layout_wide<span class="o">$</span>final_name <span class="o">&lt;-</span> gsub<span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">,</span> layout_wide<span class="o">$</span>final_name<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Error in gsub(&quot; &quot;, &quot;_&quot;, layout_wide$final_name): object &#39;layout_wide&#39; not found
</pre></div>


<div class="highlight"><pre>head<span class="p">(</span>layout_wide<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Error in head(layout_wide): object &#39;layout_wide&#39; not found
</pre></div>


<p>Now we can hand our data frame of headers back to fwf using <code>fwf_positions</code> and get meaningful data:</p>
<div class="highlight"><pre>sample_file <span class="o">=</span> <span class="s">&quot;http://www.state.nj.us/education/schools/achievement/14/njask8/state_summary.txt&quot;</span>

njask14_gr8 <span class="o">&lt;-</span> readr<span class="o">::</span>read_fwf<span class="p">(</span>
  file <span class="o">=</span> sample_file<span class="p">,</span>
  col_positions <span class="o">=</span> readr<span class="o">::</span>fwf_positions<span class="p">(</span>
    start <span class="o">=</span> layout_wide<span class="o">$</span>field_start_position<span class="p">,</span>
    end <span class="o">=</span> layout_wide<span class="o">$</span>field_end_position<span class="p">,</span>
    col_names <span class="o">=</span> layout_wide<span class="o">$</span>final_name
  <span class="p">),</span>
  na <span class="o">=</span> <span class="s">&quot;*&quot;</span>
<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Error in stopifnot(length(start) == length(end)): object &#39;layout_wide&#39; not found
</pre></div>


<p>success!
let's look at just a sample of 10 rows and 10 columns from that:</p>
<div class="highlight"><pre>dplyr<span class="o">::</span>sample_n<span class="p">(</span>njask14_gr8<span class="p">[,</span> sample<span class="p">(</span>c<span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">551</span><span class="p">),</span> <span class="m">10</span><span class="p">)],</span> <span class="m">10</span><span class="p">)</span> <span class="o">%&gt;%</span> as.data.frame<span class="p">()</span>
</pre></div>


<div class="highlight"><pre>## Error: Sample size (10) greater than population size (0). Do you want replace = TRUE?
</pre></div>


<p>In the next post, we'll talk about how to turn this linear script into a function that can process all of the state data.</p>
<h1>appendix: all 551 headers</h1>
<div class="highlight"><pre>layout_wide<span class="o">$</span>final_name
</pre></div>


<div class="highlight"><pre>## Error in eval(expr, envir, enclos): object &#39;layout_wide&#39; not found
</pre></div></div>
	<hr>

	
</div>
		</div>
	</div>
</div>

<!-- FOOTER -->
<div class="container">
	<div class="row">
		<div class="col-md-11 text-center center-block aw-bottom">
			<p>almart.in is built with <a href="http://docs.getpelican.com/en/3.5.0/#">pelican</a></p>
		</div>
	</div>
</div>
<!-- JavaScript -->
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script type="text/javascript">
jQuery(document).ready(function($) {
	$("div.collapseheader").click(function () {
		$header = $(this).children("span").first();
		$codearea = $(this).children(".input_area");
		$codearea.slideToggle(500, function () {
			$header.text(function () {
				return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
			});
		});
	});
});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61809650-1', 'auto');
  ga('send', 'pageview');

</script>

 
</body>
</html>